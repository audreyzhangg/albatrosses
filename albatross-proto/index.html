<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Albatross Exploration</title>
  <link rel="stylesheet" href="styles.css"/>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <style>
  @font-face {
    font-family: 'TAN-Nimbus';
    src: url('TAN-NIMBUS.otf') format('opentype');
    font-weight: normal;
    font-style: normal;
  }

  :root{
    --ink:#0f172a;
    --ink-2:#1f2937;
    --muted:#6b7280;
    --chip:#f3f4f6;
    --chip-b:#e5e7eb;
    --chip-act:#e8f0ff;
    --chip-act-b:#bfdbfe;

    /* shared sizing used by map + myths */
    --panel-h: 500px;
    --panel-w: 900px;
  }

  /* Global: prevent any “peek-through” */
  section, .section, .transition-section {
    /* overflow: clip;
    contain: paint; */
    background:#ffffff;
    /* isolation:isolate; */
  }
  @supports not (overflow: clip) {
    section, .section, .transition-section { overflow: hidden; }
  }

  html, body{ height:auto; }
  /* Smooth + snap scrolling for page sections */
  html { scroll-behavior: smooth; }
  body{
    margin:0;
    font-family: ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
    background:#ffffff;
    color:var(--ink);
  }


  /* Section styling */
  .section {
    padding: 60px 20px;
    max-width: 1400px;
    margin: 0 auto;
    min-height: 85vh; /* keeps one “page” in view */
  }

  .section h1 {
    font-size: 32px;
    font-family: 'TAN-Nimbus', sans-serif;
    text-align: center;
    margin-bottom: 10px;
    color: #2c3e50;
  }

  .section .subtitle {
    text-align: center;
    color: var(--muted);
    margin-bottom: 30px;
    font-size: 18px;
  }

  /* Landing */
    #landing-section {
    min-height: 100vh;                    /* full screen */
    display: flex;
    align-items: center;
    justify-content: center;

    background-image: url('images/titlebackground.png');
    background-size: cover;               /* fill the screen */
    background-position: center;
    background-repeat: no-repeat;

    color: #ffffff;                       /* make title readable */
  }
  /* Landing title: move up a bit and make white */
  .landing-title-container {
    line-height: 1.5;
    transform: translateY(-60px);            /* lift the text above the horizon */
  }

  #landing-section .landing-title {
    color: #ffffff;                          /* override the dark .section h1 color */
    font-family: 'TAN-Nimbus', sans-serif;
    margin: 0;
    text-shadow: 2.8px -2.8px 0 rgba(19, 92, 184, 0.5);
  }

  #landing-section .landing-title-top {
    font-size: 65px;
  }

  #landing-section .landing-title-bottom {
    font-size: 90px;
  }

  #landing-section h1 {
    color: #ffffff; /* you already changed this, but just to be safe */
  }

  /* Make the shift a bit smaller on narrow screens */
  @media (max-width: 768px) {
    .landing-title-container {
      transform: translateY(-40px);
    }

    #landing-section .landing-title-top {
      font-size: 35px;
    }

    #landing-section .landing-title-bottom {
      font-size: 50px;
    }
  }

/* Intro / welcome hero section */

  #welcome {
    display: flex;
    align-items: center;
    justify-content: center;
  }

  /* Layout: bird left, text right */
  .welcome-inner {
    max-width: 900px;
    margin: 0 auto;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 32px;
  }

  /* Bird image column */
  .welcome-image {
    max-width: 220px;
    height: auto;
    flex-shrink: 0;
  }

  /* Text column */
  .welcome-text {
    max-width: 520px;
  }

  /* Make intro text black with no shadow */
  .welcome-text h2,
  .welcome-text p {
    color: #111827;       /* or #0f172a if you want it a bit darker */
    text-shadow: none;
  }

  .welcome-text h2 {
    margin: 0 0 12px 0;
    font-size: 28px;
    font-weight: 700;
  }

  .welcome-text p {
    margin: 0;
    font-size: 18px;
    line-height: 1.5;
  }

  /* Stack on small screens */
  @media (max-width: 768px) {
    .welcome-inner {
      flex-direction: column;
      text-align: center;
    }
  }


  /* Intro (anatomy visual page uses same id as before) */
  #intro-section { background: #ffffff; }

  #intro-visual {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 20px 0;
  }

  #intro-visual svg {
    width: min(95vw, 1100px);
    height: auto;
    display: block;
  }

  .wing-hotspot{ fill: rgba(0,0,0,0); cursor:pointer; }
  .wing-hotspot:hover{ fill: rgba(0,0,0,0.06); }
  .stomach-hotspot{ fill: rgba(0,0,0,0); cursor:pointer; }
  .stomach-hotspot:hover{ fill: rgba(255,165,0,0.12); }
  .beak-hotspot{ fill: rgba(0,0,0,0); cursor:pointer; }
  .beak-hotspot:hover{ fill: rgba(255,99,71,0.12); }

  /* Quiz */
  #quiz-section {
    background: linear-gradient(
      to bottom,
      #ffffff 0%,
      #d9ecfb 12%,
      #d9ecfb 88%,
      #ffffff 100%
    );
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 30vh 20px 40px;
    min-height: 100vh;   /* use full viewport height so flex centering is true center */
  }

  #quiz-container { max-width: 600px; text-align: center; padding: 40px; }
  #quiz-question { font-size: 22px; font-weight: 600; color: #2c3e50; margin-bottom: 30px; line-height: 1.4; }
  #quiz-input-container { margin: 30px 0; position: relative; }
  #quiz-input {
    width: 100%; padding: 15px 20px; font-size: 18px; border: 3px solid #e5e7eb;
    border-radius: 12px; outline: none; transition: border-color 0.3s ease; font-family: inherit;
  }
  #quiz-input:focus { border-color: #2563eb; box-shadow: 0 0 0 3px rgba(37,99,235,0.1); }
  #quiz-submit {
    margin-top: 20px; padding: 12px 30px; font-size: 18px; font-weight: 600; background: #2563eb;
    color: white; border: none; border-radius: 12px; cursor: pointer; transition: all 0.3s ease;
  }
  #quiz-submit:hover { background: #1d4ed8; transform: translateY(-2px); }
  #quiz-submit:disabled { background: #94a3b8; cursor: not-allowed; transform: none; }

  #quiz-answer {
    margin-top: 30px; padding: 20px; background: #ecfdf5; border: 2px solid #10b981; border-radius: 12px;
    opacity: 0; transform: translateY(20px); transition: all 0.5s ease;
  }
  #quiz-answer.correct { background: #ecfdf5; border-color: #10b981; }
  #quiz-answer.incorrect { background: #fef2f2; border-color: #ef4444; }
  #quiz-answer.visible { opacity: 1; transform: translateY(0); }
  #quiz-answer h3 { color: #047857; font-size: 24px; margin: 0 0 10px 0; }
  #quiz-answer.incorrect h3 { color: #dc2626; }
  #quiz-answer p { color: #065f46; font-size: 16px; margin: 0; line-height: 1.6; }
  #quiz-answer.incorrect p { color: #991b1b; }
  #quiz-continue {
    margin-top: 25px; padding: 12px 25px; font-size: 16px; font-weight: 600; background: #047857;
    color: white; border: none; border-radius: 8px; cursor: pointer; transition: all 0.3s ease;
    opacity: 0; transform: translateY(10px);
  }
  #quiz-continue.visible { opacity: 1; transform: translateY(0); }
  #quiz-continue:hover { background: #065f46; transform: translateY(-1px); }
  #quiz-answer.incorrect #quiz-continue { background: #dc2626; }
  #quiz-answer.incorrect #quiz-continue:hover { background: #b91c1c; transform: translateY(-1px); }

  /* Distance (Map) */
  #distance-section { background: #ffffff; }
  #distance-container { max-width: var(--panel-w); margin: 0 auto; text-align: center; }
  #distance-info { font-size: 24px; color: #2c3e50; margin-bottom: 30px; font-weight: 600; }
  #distance-map {
    width: 100%; height: var(--panel-h) !important; border: 2px solid #dbf0fe;
    border-radius: 12px; margin: 20px 0; z-index: 1;
  }
  .distance-info-control { font-family: inherit; font-size: 14px; line-height: 1.4; }
  .leaflet-popup-content { font-family: inherit; font-size: 13px; }

  /* Species */
  #species-section { background: #ffffff; }
  #species-legend {
    display: flex; justify-content: center; flex-wrap: wrap; gap: 12px; margin-bottom: 20px; padding: 10px;
  }
  .legend-item { display: flex; align-items: center; gap: 8px; font-size: 16px; color: #2c3e50; }
  .legend-circle { width: 20px; height: 20px; border-radius: 50%; border: 10px solid; }
  #species-visualization { position: relative; width: 100%; min-height: 650px; }
  .bird-icon { fill: #34495e; } .status-ring { fill: none; stroke-width: 10; }
  .bird-label { font-size: 14px; fill: #2c3e50; text-anchor: middle; font-weight: 500; }
  .fact-card {
    position: absolute; background: white; border: 2px solid #2c3e50; border-radius: 8px; padding: 15px;
    max-width: 350px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); pointer-events: none; opacity: 0;
    transition: opacity 0.2s; z-index: 1000; font-size: 14px;
  }
  .fact-card.visible { opacity: 1; }
  .fact-card h3 { margin: 0 0 10px 0; color: #2c3e50; font-size: 18px; }
  .fact-card .fun-fact { background: #f0f8ff; padding: 10px; border-radius: 4px; margin-bottom: 10px; font-style: italic; color: #34495e; }
  .fact-card .stat { margin: 5px 0; color: #555; }
  .fact-card .stat strong { color: #2c3e50; }

  /* Threats */
  #threats-section { background: #ffffff; padding-left: 100px; }
  .threats-layout {
    display: grid; grid-template-columns: 300px 1fr; gap: 40px; align-items: start; padding-top: 0;
  }
  .threats-left { padding-top: 180px; }
  .threats-left h1 { font-size: 32px; margin-bottom: 10px; margin-top: 0; color: #2c3e50; text-align: left; }
  .threats-left .subtitle { text-align: left; color: var(--muted); margin-bottom: 30px; font-size: 16px; line-height: 1.5; }
  .threats-right { overflow-x: auto; overflow-y: visible; }
  #matrix-viz { display: flex; justify-content: flex-start; width: 100%; }
  #matrix-viz svg { max-width: 100%; }
  .species-label{ font-size:13px; fill:#2c3e50; text-anchor:end; }
  .threat-label{ font-size:12px; fill:#2c3e50; text-anchor:start; }
  .matrix-circle{ cursor:pointer; }
  .grid-line{ stroke:#e5e7eb; stroke-width:1; }
  .threats-legend { display: flex; justify-content: center; gap: 20px; margin-bottom: 20px; flex-wrap: wrap; align-items: center; }
  .threats-legend-vertical { display: flex; flex-direction: column; gap: 12px; }
  .threats-legend-item { display: flex; align-items: center; gap: 8px; font-size: 14px; }
  .threats-legend-circle { border-radius: 50%; background: #888; }

  @media (max-width: 1200px) {
    #threats-section { padding-left: 20px; }
    .threats-layout { grid-template-columns: 1fr; gap: 20px; }
    .threats-left { padding-top: 0; }
    .threats-left h1, .threats-left .subtitle { text-align: center; }
    .threats-legend-vertical { flex-direction: row; flex-wrap: wrap; justify-content: center; }
    #matrix-viz { justify-content: center; }
  }

  /* Myths carousel styles (scoped) */
  #myths-section { background: #ffffff; }
  .pc-stage {
    position: relative; border: 1px solid var(--chip-b); border-radius: 14px; background: #fff; overflow: hidden;
    box-shadow: 0 8px 24px rgba(0,0,0,.05);
  }
  .pc-viewport { overflow-x: auto; overflow-y: hidden; scroll-snap-type: x mandatory; scroll-behavior: smooth; scrollbar-width: none; }
  .pc-viewport::-webkit-scrollbar { display: none; }
  .pc-track { display: flex; gap: 18px; padding: 18px; }
  .pc-card {
    flex: 0 0 100%; scroll-snap-align: start; border: 2px solid #0f172a; border-radius: 12px; background: #fff;
    box-shadow: 0 10px 24px rgba(0,0,0,.06); display: grid; grid-template-columns: 1fr 1fr; gap: 0;
    width: 100%; height: var(--panel-h); overflow: hidden;
  }
  .pc-left, .pc-right { min-height: 0; overflow-y: auto; }
  .pc-lines { display: none; }
  .pc-kicker { margin: 0 0 16px 0; font-size: 14px; color: #64748b; text-transform: uppercase; letter-spacing: 0.5px; font-weight: 600; }
  .pc-text p { margin: 0 0 12px 0; font-size: 18px; line-height: 1.6; color: #0b1220; }
  .pc-text p:last-child { margin-bottom: 16px; }
  .pc-divider { display: none; }
  .pc-right { position: relative; padding: 20px; display: flex; flex-direction: column; gap: 8px; border-left: 1px solid #e5e7eb; flex: 1; }
  .pc-meta { align-self: start; margin-top: 0; flex-shrink: 0; margin-bottom: 12px; }
  .pc-title { font-weight: 800; font-size: 24px; margin-bottom: 8px; line-height: 1.2; }
  .pc-country { font-weight: 700; color: #334155; margin-bottom: 6px; font-size: 15px; }
  .pc-source { font-size: 13px; color: #94a3b8; }
  .pc-hero { width: 100%; height: auto; max-height: 400px; background-size: cover; background-position: center; border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); flex: 1; }
  .pc-hero.pc-hero-ph { background: linear-gradient(135deg, #eef2ff, #e0e7ff); }
  .pc-quote { margin: 16px 0 0 0; padding: 8px; background: #f1f5f9; border-left: 2px solid #64748b; font-style: italic; color: #334155; font-size: 16px; line-height: 1.5; }
  .pc-quote-attr { font-size: 12px; color: #94a3b8; }

  .carousel-btn {
    position: absolute; top: 50%; transform: translateY(-50%); z-index: 5; width: 46px; height: 46px; border-radius: 999px;
    border: 1px solid var(--chip-b); background: #fff; box-shadow: 0 6px 16px rgba(0,0,0,.12);
    font-size: 28px; line-height: 1; color: #0f172a; cursor: pointer;
  }
  .carousel-btn:hover { background: var(--chip-act); cursor: pointer; }
  .carousel-btn.prev { left: -56px; }
  .carousel-btn.next { right: -56px; }

  #myths-section .pc-footer,
  #myths-section #pcCounter,
  #myths-section .hint,
  #myths-section .pc-dots { display: none !important; }

  #myths-section .pc-stage{
    max-width: var(--panel-w); width: 100%; margin: 0 auto; padding: 18px; height: var(--panel-h) !important; overflow: visible !important;
  }
  #myths-section .pc-viewport{ width: 100%; height: 100% !important; overflow-x: hidden; overflow-y: hidden; scroll-snap-type: x mandatory; scroll-padding: 0; border-radius: 12px; }
  #myths-section .pc-viewport::-webkit-scrollbar{ display:none; }
  #myths-section .pc-track{ height: 100% !important; width: 100%; gap: 0 !important; padding: 0 !important; }
  #myths-section .pc-card{
    flex: 0 0 100%; width: 100%; height: 100% !important; border: none !important; box-shadow: 0 10px 24px rgba(0,0,0,.06);
    margin: 0; overflow: hidden; --pc-body: 15px; --pc-kicker: 12px; --pc-title: 20px; --pc-country: 13px; --pc-source: 12px; --pc-quote: 14px;
  }
  #myths-section .pc-right{ display:flex; flex-direction:column; }
  #myths-section .pc-meta,
  #myths-section .pc-title,
  #myths-section .pc-country,
  #myths-section .pc-source,
  #myths-section .pc-quote{ flex-shrink:0; }
  #myths-section .pc-hero{ flex: 1 1 auto; min-height: 0; max-height: 100%; background-size: cover; background-position: center; }
  #myths-section .pc-hero img{ width: 100%; height: 100%; object-fit: cover; display: block; }
  #myths-section .pc-text p{ font-size: var(--pc-body) !important; line-height: 1.55 !important; }
  #myths-section .pc-kicker{ font-size: var(--pc-kicker) !important; letter-spacing: .4px; }
  #myths-section .pc-title{ font-size: var(--pc-title) !important; }
  #myths-section .pc-country{ font-size: var(--pc-country) !important; }
  #myths-section .pc-source{ font-size: var(--pc-source) !important; }
  #myths-section .pc-quote{ font-size: var(--pc-quote) !important; line-height: 1.45; }
  #myths-section .pc-quote-attr{ font-size: 12px !important; color: #94a3b8; }
  #myths-section .pc-left, 
  #myths-section .pc-right{ padding: 14px !important; }

  /* Right Panel (species popup) */
  #species-panel {
    position: fixed; top: 0; right: -450px; width: 450px; height: 100vh; background: white;
    box-shadow: -4px 0 20px rgba(0,0,0,0.15); transition: right 0.3s ease; z-index: 1000; overflow-y: auto; padding: 20px;
  }
  #species-panel.open { right: 0; }
  #species-panel-close {
    position: absolute; top: 10px; right: 10px; background: none; border: none; font-size: 28px; cursor: pointer; color: var(--ink);
    width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: background 0.2s;
  }
  #species-panel-close:hover { background: #f3f4f6; }
  #species-panel-content h2 { margin-top: 0; margin-bottom: 10px; color: #2c3e50; font-size: 24px; }
  #species-panel-content h3 { margin: 15px 0 5px 0; color: #2c3e50; font-size: 18px; }
  #species-panel-image { width: 100%; max-width: 400px; height: auto; border-radius: 8px; margin: 15px 0; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
  #species-panel-info { margin: 20px 0; } #species-panel-info p { margin: 8px 0; line-height: 1.6; } #species-panel-info .info-label { font-weight: 600; color: #2c3e50; }
  #species-panel-map-container { margin-top: 30px; border-top: 2px solid #e5e7eb; padding-top: 20px; }
  #species-panel-map { width: 100%; height: 350px; border: 1px solid var(--chip-b); border-radius: 8px; background: #e6f3ff; }
  .colony { fill: #2563eb; fill-opacity: 0.88; stroke: #0f172a; stroke-width: 0.5; stroke-opacity: 0.25; cursor: pointer; }
  .colony.highlight { stroke-width: 2; stroke-opacity: 0.8; filter: drop-shadow(0 0 4px rgba(37,99,235,0.6)); }
  .country { fill: #f1efe8; stroke: #94a3b8; stroke-width: 0.6; }
  .graticule { fill: none; stroke: #bfdbfe; stroke-width: 0.5; opacity: 0.6; }

  /* Side navigation dots */
  .nav-dots {
    position: fixed; right: 20px; top: 50%; transform: translateY(-50%); z-index: 1000;
    display: flex; flex-direction: column; gap: 12px;
  }
  .nav-dot {
    width: 12px; height: 12px; border-radius: 50%; background: rgba(44,62,80,.3); border: 2px solid rgba(44,62,80,.5);
    cursor: pointer; transition: all .3s ease; position: relative;
  }
  .nav-dot:hover { background: rgba(44,62,80,.6); transform: scale(1.2); }
  .nav-dot.active { background: #2c3e50; border-color: #2c3e50; transform: scale(1.3); }
  .nav-dot::after{
    content: attr(data-label); position: absolute; right: 25px; top: 50%; transform: translateY(-50%);
    background: rgba(44,62,80,.9); color: #fff; padding: 4px 8px; border-radius: 4px; font-size: 12px; white-space: nowrap;
    opacity: 0; pointer-events: none; transition: opacity .3s ease;
  }
  .nav-dot:hover::after{ opacity: 1; }
  @media (max-width: 768px){ .nav-dots{ display:none; } }

  /* Conservation cards */
  #conservation-section .cons-grid {
    max-width: var(--panel-w);
    margin: 0 auto;
    display: grid;
    grid-template-columns: repeat(3, minmax(0,1fr));
    gap: 16px;
  }

  #conservation-section .cons-card {
    position: relative;
    width: 100%;
    height: 280px;
    border-radius: 12px;
    background: #fff;
    box-shadow: 0 6px 16px rgba(0,0,0,.08);
    cursor: pointer;
    padding: 0;
    outline: none;
    perspective: 1000px;
    border: none; /* if you still want a black border, change this to: border: 2px solid #000; */
    transition: box-shadow .2s ease, transform .06s ease;
  }

  #conservation-section .cons-card:hover {
    box-shadow: 0 10px 24px rgba(0,0,0,.12);
  }

  #conservation-section .cons-card:active {
    transform: translateY(1px);
  }

  #conservation-section .cons-card-inner {
    position: absolute;
    inset: 0;
    border-radius: 12px;
    transform-style: preserve-3d;
    transition: transform .55s ease;
  }

  #conservation-section .cons-face {
    position: absolute;
    inset: 0;
    backface-visibility: hidden;
    border-radius: 12px;
    overflow: hidden;
    display: flex;
    flex-direction: column;
  }

  #conservation-section .cons-front {
    background: #fff;
  }

  #conservation-section .cons-img {
    width: 100%;
    height: 85%;
    object-fit: cover;
    object-position: center;
    display: block;
  }

  #conservation-section .cons-title {
    margin: 6px 12px 0 12px;
    font-size: 15px;
    line-height: 1.2;
    font-weight: 800;
    text-align: center;
    flex: 1 0 auto;
  }

  #conservation-section .cons-back {
    background: #fff;
    transform: rotateY(180deg);
    padding: 16px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    gap: 8px;
  }

  #conservation-section .cons-back h3 {
    margin: 0;
    font-size: 15px;
    line-height: 1.25;
  }

  #conservation-section .cons-back p {
    margin: 0;
    font-size: 13px;
    line-height: 1.45;
    color: #334155;
    max-width: 90%;
  }

  #conservation-section .cons-card.is-flipped .cons-card-inner {
    transform: rotateY(180deg);
  }

  @media (max-width: 980px) {
    #conservation-section .cons-grid {
      grid-template-columns: repeat(2, minmax(0,1fr));
    }
    #conservation-section .cons-card {
      height: 260px;
    }
    #conservation-section .cons-img {
      height: 82%;
    }
  }

  @media (max-width: 640px) {
    #conservation-section .cons-grid {
      grid-template-columns: 1fr;
    }
    #conservation-section .cons-card {
      height: 250px;
    }
    #conservation-section .cons-img {
      height: 80%;
    }
  }


  /* How You Can Help */
  #how-to-help-section .help-stage{ max-width: var(--panel-w); margin: 0 auto; }
  #how-to-help-section .help-card{
  height: var(--panel-h);
  border-radius: 14px;
  background: #d9ecfb;                     /* unified blue */
  box-shadow: 0 10px 24px rgba(0,0,0,.06);
  overflow: hidden;
  display: grid;
  grid-template-columns: 1fr 3fr;
  border: 1px solid var(--chip-b);
}

  #how-to-help-section .help-tabs{
    background: #ffffff;                     /* same tint behind tabs */
    border-right: 1px solid var(--chip-b);
    padding: 10px;
    display: grid;
    grid-auto-rows: 1fr;
    gap: 8px;
  }

  #how-to-help-section .help-tab{
    all: unset;
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
    background: #ffffff;
    border: 1px solid var(--chip-b);
    border-radius: 10px;
    padding: 10px;
    font-weight: 700;
    color: #0f172a;
    cursor: pointer;
    box-shadow: 0 2px 6px rgba(0,0,0,.04);
  }

  #how-to-help-section .help-tab.is-active{
    background: #d9ecfb;                     /* active tab blue */
    border-color: #c0daf6;
    box-shadow: 0 4px 12px rgba(37,99,235,.15);
  }

  #how-to-help-section .help-content{
    padding: 22px;
    overflow: auto;
    display: grid;
    align-content: start;
    gap: 10px;
    background: #d9ecfb;                     /* main content blue */
    border-left: 1px solid var(--chip-b);
    box-shadow: inset 0 1px 0 rgba(255,255,255,.6);
  }

  /* #how-to-help-section .help-card{
    height: var(--panel-h); border-radius: 14px; background:#dbf0fe; box-shadow: 0 10px 24px rgba(0,0,0,.06);
    overflow: hidden; display: grid; grid-template-columns: 1fr 3fr; border: 1px solid var(--chip-b);
  }
  #how-to-help-section .help-tabs{
    background:#f8fbff; border-right:1px solid var(--chip-b); padding: 10px; display: grid; grid-auto-rows: 1fr; gap: 8px;
  }
  #how-to-help-section .help-tab{
    all: unset; display: flex; align-items: center; justify-content: center; text-align: center; background:#fff; border:1px solid var(--chip-b);
    border-radius:10px; padding: 10px; font-weight: 700; color:#0f172a; cursor:pointer; box-shadow: 0 2px 6px rgba(0,0,0,.04);
  } */
  #how-to-help-section .help-tab:hover{ background:#eef6ff; }
  /* #how-to-help-section .help-tab.is-active{ background:#e8f0ff; border-color:#bfdbfe; box-shadow: 0 4px 12px rgba(37,99,235,.15); }
  #how-to-help-section .help-content{
    padding: 22px; overflow: auto; display: grid; align-content: start; gap: 10px; background:#d1e1f4;
    border-left:1px solid var(--chip-b); box-shadow: inset 0 1px 0 rgba(255,255,255,.6);
  } */
  #how-to-help-section .help-content h3{ font-size: 22px; margin:0; }
  #how-to-help-section .help-content p{ font-size: 16px; line-height:1.55; margin:0; }
  #how-to-help-section .help-content .bullets{ margin: 4px 0 0 0; padding-left: 18px; font-size: 15px; color:#334155; }
  #how-to-help-section .help-content .bullets li{ margin: 6px 0; }

  /* Donate / Adopt cards */
  #how-to-help-section .give-grid{
    display: flex;
    flex-wrap: wrap;
    gap: 16px;
    margin-top: 12px;
  }

  #how-to-help-section .give-card{
    flex: 1 1 220px;
    max-width: 260px;
    background: #f8fafc;
    border-radius: 14px;
    border: 1px solid var(--chip-b);
    box-shadow: 0 4px 10px rgba(15,23,42,0.08);
    text-decoration: none;
    color: inherit;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    transition: transform .12s ease, box-shadow .12s ease, border-color .12s ease;
  }

  #how-to-help-section .give-card:hover{
    transform: translateY(-2px);
    box-shadow: 0 8px 18px rgba(15,23,42,0.14);
    border-color: #93c5fd;
  }

  #how-to-help-section .give-card img{
    width: 100%;
    height: 150px;
    object-fit: cover;
  }

  #how-to-help-section .give-card-body{
    padding: 10px 14px 12px;
  }

  #how-to-help-section .give-card-title{
    margin: 0 0 4px 0;
    font-weight: 700;
    font-size: 16px;
  }

  #how-to-help-section .give-card-text{
    margin: 0;
    font-size: 14px;
    line-height: 1.4;
    color: #4b5563;
  }


  /* Responsive adjustments */
  @media (max-width: 980px) { .pc-card { min-height: auto; } }
  @media (max-width: 760px) {
    .pc-card { grid-template-columns: 1fr; }
    .pc-right { border-left: none; border-top: 1px solid #e5e7eb; }
    .pc-hero { max-height: 200px; }
    .pc-left { padding: 10px; }
    .pc-right { padding: 10px; }
  }

/* ---------- Transition pages: centered white card “textbox” ---------- */
  .transition-section {
    background: #ffffff;          /* plain white page */
    padding: 60px 20px;
    display: flex;
    align-items: center;          /* vertical center */
    justify-content: center;      /* horizontal center */
    min-height: 85vh;             /* keeps one “page” in view */
  }

  /* The card / textbox itself */
  .transition-section .transition-content {
    --tcard-w: 520px;
    --tcard-h: 320px;
    --tcard-font: clamp(18px, 2.1vw, 22px);

    width: min(var(--tcard-w), calc(100vw - 40px));
    height: min(var(--tcard-h), 60vh);

    background: #d9ecfb;          /* no blue background */
    border: 1px solid #d1d5db;    /* subtle light gray border (no black) */
    border-radius: 13px;          /* rounded corners */
    box-shadow: 0 10px 24px rgba(15, 23, 42, 0.08);
    padding: 28px 32px;

    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
    overflow: hidden;
  }

  /* Typography inside the card */
  .transition-section .transition-content h1,
  .transition-section .transition-content h2,
  .transition-section .transition-content h3,
  .transition-section .transition-content p {
    margin: 0;
    font-size: var(--tcard-font);
    line-height: 1.3;
    font-weight: 500;
    color: #0f172a;
  }

  .transition-section .transition-content strong {
    font-weight: 800;
  }

  /* Mobile tweaks */
  @media (max-width: 640px) {
    .transition-section {
      padding: 40px 14px;
      min-height: 90vh;
    }

    .transition-section .transition-content {
      width: calc(100vw - 28px);
      height: auto;              /* let the card grow with text on small screens */
      padding: 22px 18px;
    }

    .transition-section .transition-content h1,
    .transition-section .transition-content h2,
    .transition-section .transition-content h3,
    .transition-section .transition-content p {
      font-size: 18px;
    }
  }


  .tooltip {
    position: absolute;
    pointer-events: none;
    background: rgba(15, 23, 42, 0.95);
    color: #fff;
    padding: 8px 10px;
    border-radius: 4px;
    font-size: 13px;
    line-height: 1.4;
    display: none;
    z-index: 9999;
    max-width: 260px;
  }

  /* Sources / Further reading */
/* Sources / Further reading */
#sources-section {
  background: #ffffff;
}

/* Make room for 4 cards per row on desktop */
.sources-grid {
  max-width: 1200px;  /* was var(--panel-w); */
  margin: 20px auto 0 auto;
  display: grid;
  grid-template-columns: repeat(4, minmax(0, 1fr)); /* 4 columns on wide screens */
  gap: 16px; /* slightly tighter gap */
}

.source-card {
  background: #f8fafc;
  border-radius: 14px;
  border: 1px solid var(--chip-b);
  box-shadow: 0 8px 18px rgba(15,23,42,0.06);
  padding: 14px 16px 16px; /* a bit smaller */
  display: flex;
  flex-direction: column;
}

/* Typography inside cards */
  .source-card h3 {
    margin: 0 0 6px 0;
    font-size: 15px;
    font-weight: 700;
    color: #0f172a;
  }

  .source-card p {
    margin: 0 0 6px 0;
    font-size: 12px;
    color: #64748b;
  }

  .source-card ul {
    margin: 0;
    padding-left: 16px;
    font-size: 13px;
  }

  .source-card li {
    margin: 3px 0;
  }

  .source-card a {
    color: #1d4ed8;
    text-decoration: none;
    font-size: 11px;
  }

  .source-card a:hover {
    text-decoration: underline;
  }

  /* Responsive breakpoints so it still looks good on smaller screens */
  @media (max-width: 1100px) {
    .sources-grid {
      grid-template-columns: repeat(3, minmax(0, 1fr));
    }
  }

  @media (max-width: 840px) {
    .sources-grid {
      grid-template-columns: repeat(2, minmax(0, 1fr));
    }
  }

  @media (max-width: 520px) {
    .sources-grid {
      grid-template-columns: 1fr;
    }
  }

  /* --- Final overrides for Credits layout --- */
  #credits-section {
    /* make the page taller so Sources never peeks in */
    min-height: 105vh;      /* you can bump to 115–120vh if you want even more */
    display: flex;
    align-items: flex-start; /* no vertical centering */
    justify-content: center;
    padding: 64vh 20px 40px; /* big top padding pushes content down */
    /* background: #d9ecfb;     solid blue, no bottom fade */
    background: linear-gradient(
      to bottom,
      #ffffff 0%,
      #d9ecfb 12%
    );
  }

  #credits-inner {
    text-align: center;
  }

  /* keep image + names the same, just here in case earlier rules conflict */
  #credits-inner img {
    display: block;
    /* margin: 0 auto 8px; */
    width: 140px;
    height: auto;
  }

  .credits-names div,
  #credits-inner .credit-name {
    font-size: 15px;
    line-height: 1.3;
    color: #111827;
  }


  </style>
</head>

<script>
  // Keep --panel-h equal to the current #distance-map height
  function syncPanelHeightToMap(){
    const dm = document.getElementById('distance-map');
    if(!dm) return;
    const h = Math.round(dm.getBoundingClientRect().height);
    document.documentElement.style.setProperty('--panel-h', h + 'px');
  }
  window.addEventListener('load', syncPanelHeightToMap);
  window.addEventListener('resize', syncPanelHeightToMap);
  setTimeout(syncPanelHeightToMap, 300);
</script>

<script>
  // Flip cards in Conservation Efforts
  document.addEventListener('DOMContentLoaded', function () {
    document.querySelectorAll('#conservation-section .cons-card').forEach(card => {
      card.addEventListener('click', () => { card.classList.toggle('is-flipped'); });
      card.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); card.classList.toggle('is-flipped'); }
      });
    });
  });
</script>

<!-- UPDATED HELP COPY -->
<script>
  const HELP_COPY = {
    plastic: {
      title: "Avoid Plastic",
      body: `
        Plastic doesn’t break down. Rather, it fragments, drifts at sea, and enters food webs.
        Small choices at home can keep debris out of albatross habitat.`,
      bullets: [
        "Carry reusables; skip single-use bags, bottles, and utensils.",
        "Secure trash and fishing line so it can’t blow to waterways.",
        "Check out Surfrider’s “Rise Above Plastics” for easy swaps."
      ]
    },
    acap: {
      title: "Support ACAP (Albatrosses & Petrels)",
      body: `
        The Agreement on the Conservation of Albatrosses and Petrels coordinates
        international science and policy for 30 seabird species. Backing ACAP helps
        keep proven bycatch solutions on the water.`,
      bullets: [
        "Learn from ACAP’s species pages and bycatch resources.",
        "Share why ACAP matters; encourage US support and participation.",
        "Sign action alerts from conservation groups."
      ]
    },
    kids: {
      title: "Read Kids’ Books",
      body: `
        Albatross lives (long-term partners, devoted parents, etc.) make great stories.
        Children’s books spark empathy and stewardship early.`,
      bullets: [
        "Pick a conservation-minded title from ACAP’s book list.",
        "Read together; talk about ocean wildlife and threats.",
        "Donate a book to a classroom or library."
      ]
    },
    donate: {
      title: "Donate or Adopt",
      body: `
        If you prefer a direct impact, two trusted options support research and bycatch
        reduction and even let you “adopt” an albatross to fund monitoring and protection.`,
      bullets: [
        `Donate: <a href="https://www.birdlife.org/campaigns-appeals/albatross-sos/#donate-form" target="_blank" rel="noopener">BirdLife International – Albatross SOS</a>`,
        `Adopt: <a href="https://www.oceanicsociety.org/adopt/adopt-an-albatross/" target="_blank" rel="noopener">Oceanic Society – Adopt an Albatross</a>`
      ]
    },
    pelagic: {
      title: "See Them at Sea",
      body: `
        Pelagic trips off the West Coast often spot Black-footed and sometimes Laysan albatrosses.
        Even short whale-watching outings in Monterey Bay can deliver great looks.`,
      bullets: [
        "Book reputable operators (e.g., SF Bay/Monterey area).",
        "Dress warm, bring binoculars, follow crew guidance.",
        "Share photos and what you learn to inspire others."
      ]
    }
  };

  // function renderHelp(key){
  //   const data = HELP_COPY[key] || HELP_COPY.plastic;
  //   const pane = document.querySelector('#how-to-help-section .help-content');
  //   pane.innerHTML = `
  //     <h3>${data.title}</h3>
  //     <p>${data.body}</p>
  //     <ul class="bullets">${data.bullets.map(b=>`<li>${b}</li>`).join('')}</ul>
  //   `;
  // }

  function renderHelp(key){
    const pane = document.querySelector('#how-to-help-section .help-content');

    // Special layout for Donate / Adopt
    if (key === 'donate') {
      pane.innerHTML = `
        <h3>Donate or Adopt</h3>
        <p>
          If you prefer a direct impact, two trusted options support research and bycatch
          reduction and even let you “adopt” an albatross to fund monitoring and protection.
        </p>
        <div class="give-grid">
          <a class="give-card"
            href="https://www.birdlife.org/campaigns-appeals/albatross-sos/#donate-form"
            target="_blank" rel="noopener">
            <img src="images/give-donate.jpg" alt="Donate to support albatross conservation">
            <div class="give-card-body">
              <h4 class="give-card-title">Donate</h4>
              <p class="give-card-text">
                Give to BirdLife International’s Albatross SOS campaign to fund
                bycatch reduction and research.
              </p>
            </div>
          </a>

          <a class="give-card"
            href="https://www.oceanicsociety.org/adopt/adopt-an-albatross/"
            target="_blank" rel="noopener">
            <img src="images/give-adopt.jpg" alt="Adopt an albatross illustration">
            <div class="give-card-body">
              <h4 class="give-card-title">Adopt</h4>
              <p class="give-card-text">
                Symbolically adopt an albatross through Oceanic Society and support
                long-term monitoring and protection.
              </p>
            </div>
          </a>
        </div>
      `;
      return;
    }

    // Default layout for the other tabs
    const data = HELP_COPY[key] || HELP_COPY.plastic;
    pane.innerHTML = `
      <h3>${data.title}</h3>
      <p>${data.body}</p>
      <ul class="bullets">${data.bullets.map(b=>`<li>${b}</li>`).join('')}</ul>
    `;
  }


  document.addEventListener('DOMContentLoaded', () => {
    const tabs = document.querySelectorAll('#how-to-help-section .help-tab');
    tabs.forEach(btn=>{
      btn.addEventListener('click', ()=>{
        tabs.forEach(b=>b.classList.remove('is-active'));
        btn.classList.add('is-active');
        renderHelp(btn.dataset.key);
      });
    });
    renderHelp('plastic'); // initial tab
  });
</script>

<body>
  <!-- 1. Home -->
  <section id="landing-section" class="section">
    <!-- <h1 style="font-size: 64px; margin: 0;">Wings Over Water: The Albatross</h1> -->
    <div class="landing-title-container">
      <h1 class="landing-title landing-title-top">Wings Over Water:</h1>
      <h1 class="landing-title landing-title-bottom">The Albatross</h1>
    </div>
  </section>


  <!-- 2. Intro – NOT a transition page -->
  <section id="welcome" class="section">
    <div class="welcome-inner">
      <img src="images/albatross-clipart.png"
          alt="Albatross cursor guide"
          class="welcome-image">
      <div class="welcome-text">
        <h2>Albatrosses (Diomedeidae) are a family of large seabirds known for their incredibly flying skills.</h2>
        <p>
          This albatross will be your guide as we explore the data stories of the albatross!
          Use the tip of the left wing to point, click, and hover!
        </p>
      </div>
    </div>
  </section>


  <!-- 3. Quiz -->
  <section id="quiz-section" class="section">
    <div id="quiz-container">
      <p style="font-size: 20px; color: #2c3e50; margin-bottom: 30px; line-height: 1.4; text-align: center;"><strong>So... just how good are albatrosses at flying?</strong></p>
      <p style="font-size: 20px; color: #2c3e50; margin-bottom: 30px; line-height: 1.4; text-align: center;">In <em>Around the World in 80 Days</em>, the main character Phileas Fogg attempts to circumnavigate the globe in 80 days.</p>
      <p style="font-size: 20px; color: #2c3e50; margin-bottom: 30px; line-height: 1.4; text-align: center;">Albatrosses regularly make this trip by wing, travelling over 13,000 miles. Guess how many days this trip took:</p>
      <div id="quiz-input-container">
        <input type="text" id="quiz-input" placeholder="Enter your guess..." autocomplete="off">
        <button id="quiz-submit" type="button">Submit Answer</button>
      </div>
      <div id="quiz-answer">
        <h3>Just 46 days!</h3>
        <p>Albatrosses are skilled long-distance fliers, covering thousands of miles with minimal energy expenditure. They can spend months at sea without touching land! </p>
        <button id="quiz-continue" type="button">Continue Exploring →</button>
      </div>
    </div>
  </section>

  <!-- 4. Map -->
  <section id="distance-section" class="section">
    <div id="distance-container">
      <h1>All in a Day's Work</h1>
      <p class="subtitle">Albatrosses can travel up to 560 miles in a single day, traveling on average at 45 miles per hour. </p>
      <p class="subtitle">From Boston, this would reach as far as:</p>
      <div id="distance-map" data-nosnap></div>
    </div>
  </section>

  <!-- Transition: Map -> Flight -->
  <section id="transition-map-to-flight" class="section transition-section">
    <div class="transition-content">
      <h2>To cover such distances, albatrosses cleverly harness wind patterns to maintain efficiency. Meet <strong>dynamic soaring</strong>.</h2>
    </div>
  </section>

  <!-- 5. Flight -->
  <section id="scatter-section" class="section">
    <h1>Dynamic Soaring</h1>
    <p class="subtitle">Albatrosses are one of very few families of birds that utilize dynamic soaring, a special flying technique that takes advantage of ocean winds to fly without using much energy. The wind right above the waves is slow due to drag from the water and faster a few meters up. An albatross loops up and down through this wind gradient to grab free energy from the wind. One loop has four steps:</p>
    <div style="width:100%; display:flex; justify-content:center;">
      <div style="display:flex; gap:24px; width:100%; max-width:1200px; align-items:flex-start;">
        <div style="flex:1; min-width:0;">
          <iframe src="3d-scatter.html?zoom=2.7" style="width:100%;height:540px;border-radius:8px;border:1px solid rgba(0,0,0,0.12);background:#fff;box-shadow:0 6px 18px rgba(15,23,42,0.08);" allowfullscreen data-nosnap></iframe>
        </div>
        <div id="scatter-text-col" style="flex:1; min-width:0; display:flex; flex-direction:column; gap:12px; align-items:flex-start;">
          <div id="box-1" class="scatter-info" style="background:#fff;padding:16px;border-radius:8px;border:1px solid #eef2ff; width:100%;">
            <h3 style="margin:0 0 8px 0; font-size:18px; color:#2c3e50;">1. Prepare to climb:</h3>
            <p class="small" style="margin:0 0 8px 0;"> The bird stays just a meter or two above the water, where the air moves more slowly. This lets it line up the next turn with very little effort.</p>
          </div>

          <div id="box-2" class="scatter-info" style="background:#fff;padding:16px;border-radius:8px;border:1px solid #eef2ff; width:100%;">
            <h3 style="margin:0 0 8px 0; font-size:18px; color:#2c3e50;">2. Climb into the wind:</h3>
            <p class="small" style="margin:0 0 8px 0;"> The albatross faces the wind while climbing a few to ~20 meters. As it crosses into the faster-moving air aloft, its airspeed through the air increases.</p>
          </div>

          <div id="box-3" class="scatter-info scatter-jump" data-jump-t="0.66" style="background:#fff;padding:16px;border-radius:8px;border:1px solid #eef2ff; width:100%; cursor:pointer;">
            <h3 style="margin:0 0 8px 0; font-size:18px; color:#2c3e50;">3. Turn back down:</h3>
            <p class="small" style="margin:0 0 8px 0;"> Once at the top, the albatross turns down against the wind in preparation for its descent.</p>
          </div>

          <div id="box-4" class="scatter-info scatter-jump" data-jump-t="1.0" style="background:#fff;padding:16px;border-radius:8px;border:1px solid #eef2ff; width:100%; cursor:pointer;">
            <h3 style="margin:0 0 8px 0; font-size:18px; color:#2c3e50;">4. Glide down with the wind:</h3>
            <p class="small" style="margin:0 0 8px 0;"> The albatross glides downward, converting potential energy from the climb into speed as it returns to the surface layer.</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <script>
    // highlight boxes from iframe
    window.addEventListener('message', (ev) => {
      if (!ev.data || typeof ev.data !== 'object') return;
      if (ev.data.type === 'highlight-box') {
        const box = Number(ev.data.box) || 0;
        const boxes = [document.getElementById('box-1'), document.getElementById('box-2'), document.getElementById('box-3'), document.getElementById('box-4')];
        for (let i = 0; i < boxes.length; i++) {
          const el = boxes[i];
          if (!el) continue;
          if (i === (box - 1)) {
            // selected step: solid light blue
            el.style.background = '#d9ecfb';
            el.style.borderColor = '#c0daf6';
            el.style.boxShadow = '0 6px 18px rgba(15,23,42,0.10)';
            el.style.opacity = '1';
            el.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
          } else {
            // non-selected steps: white
            el.style.background = '#ffffff';
            el.style.borderColor = '#e5e7eb';
            el.style.boxShadow = 'none';
            el.style.opacity = '0.6';
          }
        }
      }
    }, false);

    // jump-to from text
    window.addEventListener('DOMContentLoaded', () => {
      const iframe = document.querySelector('iframe[src^="3d-scatter.html"]');
      if (!iframe) return;
      document.querySelectorAll('.scatter-jump').forEach(el => {
        el.style.cursor = 'pointer';
        el.addEventListener('click', () => {
          const t = parseFloat(el.dataset.jumpT || '0');
          iframe.contentWindow.postMessage({ type: 'jump-to-t', t: t }, '*');
        });
      });
    });
  </script>

  <!-- Transition: Flight -> Anatomy -->
  <section id="transition-flight-to-anatomy" class="section transition-section">
    <div class="transition-content">
      <h2>That elegance is engineered; let’s look at the albatross’s <strong>anatomy</strong>.</h2>
    </div>
  </section>

  <!-- 6. Anatomy -->
  <section id="intro-section" class="section">
    <h1>Anatomy of an Albatross</h1>
    <p class="subtitle">Click the highlighted regions (wings, stomach, beak) to see information.</p>
    <div id="intro-visual" data-nosnap></div>
  </section>

  <!-- Transition: Anatomy -> Species -->
  <section id="transition-anatomy-to-species" class="section transition-section">
    <div class="transition-content">
      <h2>Across the world’s oceans, <strong>22 species</strong> take these traits in different directions.</h2>
    </div>
  </section>

  <!-- 7. Species -->
  <section id="species-section" class="section">
    <h1>Exploring By The Species</h1>
    <p class="subtitle">Click on each species for more information!</p>
    <div id="species-legend"></div>
    <div id="species-visualization" data-nosnap></div>
  </section>

  <!-- Transition: Species -> Folklore -->
  <section id="info-folklore-section" class="section transition-section">
    <div class="transition-content">
      <h2>For millennia, the same winds that guided albatrosses also guided sailors and inspired stories. Indeed, albatrosses soon became <strong>an omen, a muse, and a myth.</strong></h2>
    </div>
  </section>

  <!-- 8. Folklore -->
  <section id="myths-section" class="section">
    <h1>Folklore & Superstitions</h1>
    <p class="subtitle">Flip through famous appearances of the albatross in literature and history.</p>
    <div class="pc-stage" data-nosnap>
      <button id="prevBtn" class="carousel-btn prev" aria-label="Previous story" title="Previous">‹</button>
      <div id="pcViewport" class="pc-viewport" aria-label="Postcard viewport">
        <div id="pcTrack" class="pc-track" role="list"></div>
      </div>
      <button id="nextBtn" class="carousel-btn next" aria-label="Next story" title="Next">›</button>
      <div class="pc-footer">
        <span id="pcCounter" class="pc-counter">—</span>
        <span class="hint">Use arrows or swipe to explore.</span>
      </div>
    </div>
  </section>

  <script>
  (function(){
    function lockMythsHeight(){
      const map = document.getElementById('distance-map');
      const h = map ? Math.round(map.getBoundingClientRect().height) : null;
      const stage = document.querySelector('#myths-section .pc-stage');
      const cards = document.querySelectorAll('#myths-section .pc-card');
      if(stage && h){ stage.style.height = h + 'px'; }
      cards.forEach(c => { c.style.height = (h || getComputedStyle(stage).height) ; });
    }
    window.addEventListener('load', lockMythsHeight);
    window.addEventListener('resize', lockMythsHeight);
    const track = document.getElementById('pcTrack');
    if(track){
      const mo = new MutationObserver(lockMythsHeight);
      mo.observe(track, { childList: true, subtree: true });
    }
  })();
  </script>

  <!-- Transition: Folklore -> Threats -->
  <section id="transition-1-section" class="section transition-section">
    <div class="transition-content">
      <h2>Unfortunately, the winds that albatrosses follow now carry <strong>new hazards</strong>.</h2>
    </div>
  </section>

  <!-- 9. Threats -->
  <section id="threats-section" class="section">
    <div class="threats-layout">
      <div class="threats-left">
        <h1>Threats</h1>
        <p class="subtitle">Each circle represents a threat affecting a species. Hover for details.</p>
        
        <div style="margin-bottom: 25px;">
          <div style="font-weight: 600; margin-bottom: 10px; color: #2c3e50; font-size: 16px;">Conservation Status</div>
          <div class="threats-legend-vertical">
            <div class="threats-legend-item"><div class="threats-legend-circle" style="width:12px; height:12px; background:#DD403A;"></div><span>Critically Endangered</span></div>
            <div class="threats-legend-item"><div class="threats-legend-circle" style="width:12px; height:12px; background:#FF7B3D;"></div><span>Endangered</span></div>
            <div class="threats-legend-item"><div class="threats-legend-circle" style="width:12px; height:12px; background:#FFC34B;"></div><span>Vulnerable</span></div>
            <div class="threats-legend-item"><div class="threats-legend-circle" style="width:12px; height:12px; background:#5AB361;"></div><span>Near Threatened</span></div>
            <div class="threats-legend-item"><div class="threats-legend-circle" style="width:12px; height:12px; background:#2F6690;"></div><span>Least Concern</span></div>
          </div>
        </div>
        
        <div style="margin-bottom: 20px;">
          <div style="font-weight: 600; margin-bottom: 10px; color: #2c3e50; font-size: 16px;">Threat Impact</div>
          <div class="threats-legend-vertical">
            <div class="threats-legend-item"><div class="threats-legend-circle" style="width:24px; height:24px;"></div><span>High Impact</span></div>
            <div class="threats-legend-item"><div class="threats-legend-circle" style="width:18px; height:18px;"></div><span>Medium Impact</span></div>
            <div class="threats-legend-item"><div class="threats-legend-circle" style="width:12px; height:12px;"></div><span>Low Impact</span></div>
          </div>
        </div>
      </div>
      <div class="threats-right" data-nosnap>
        <div id="matrix-viz"></div>
      </div>
    </div>
  </section>

  <!-- Transition: Threats -> Conservation -->
  <section id="transition-2-section" class="section transition-section">
    <div class="transition-content">
      <h2>Fortunately, fishermen, scientists, and policymakers have been banding together to <strong>take a stance</strong> for the albatrosses.</h2>
    </div>
  </section>

  <!-- 10. Conservation -->
  <section id="conservation-section" class="section">
    <h1>Conservation Efforts</h1>
    <p class="subtitle">The following displays 6 major ways advocates have been working to prevent albatrosses' further demise to bycatch.</p>

    <div class="cons-grid" data-nosnap>
      <button class="cons-card" aria-label="Streamer Lines (flip for details)">
        <div class="cons-card-inner">
          <div class="cons-face cons-front">
            <img src="images/placeholder-streamer.jpg" alt="Streamer lines behind a fishing vessel" class="cons-img"/>
            <h3 class="cons-title">Streamer Lines</h3>
          </div>
          <div class="cons-face cons-back">
            <h3>Streamer Lines</h3>
            <p>Colorful “tori” streamers flap behind longline boats and keep birds off baited hooks. Widely adopted, these lines have slashed seabird bycatch - often by more than 80% — in places like Alaska.</p>
          </div>
        </div>
      </button>

      <button class="cons-card" aria-label="Set Gear at Night (flip for details)">
        <div class="cons-card-inner">
          <div class="cons-face cons-front">
            <img src="images/placeholder-night.jpg" alt="Nighttime longline setting" class="cons-img"/>
            <h3 class="cons-title">Set Gear at Night</h3>
          </div>
          <div class="cons-face cons-back">
            <h3>Set Gear at Night</h3>
            <p>Albatrosses feed mostly by day. Setting lines in darkness and keeping deck lights low and inboard drops encounters dramatically in West Coast and Western Pacific fisheries.</p>
          </div>
        </div>
      </button>

      <button class="cons-card" aria-label="Weighted Hooks (flip for details)">
        <div class="cons-card-inner">
          <div class="cons-face cons-front">
            <img src="images/placeholder-weights.jpg" alt="Weights near hooks" class="cons-img"/>
            <h3 class="cons-title">Weighted Hooks</h3>
          </div>
          <div class="cons-face cons-back">
            <h3>Weighted Hooks</h3>
            <p>Adding weights makes baited hooks sink fast—beyond the 1–2&nbsp;m depths where most albatrosses grab food, reducing the chance birds reach the gear.</p>
          </div>
        </div>
      </button>

      <button class="cons-card" aria-label="Dyeing Bait (flip for details)">
        <div class="cons-card-inner">
          <div class="cons-face cons-front">
            <img src="images/placeholder-bait.jpg" alt="Blue-dyed bait" class="cons-img"/>
            <h3 class="cons-title">Dyeing Bait</h3>
          </div>
          <div class="cons-face cons-back">
            <h3>Dyeing Bait</h3>
            <p>Blue-dyed bait is harder for birds to spot against seawater. The approach began with fishers, was tested, and is now required in certain US HMS longline fisheries.</p>
          </div>
        </div>
      </button>

      <button class="cons-card" aria-label="Discharge Fish Waste (flip for details)">
        <div class="cons-card-inner">
          <div class="cons-face cons-front">
            <img src="images/placeholder-discharge.jpg" alt="Discharging fish waste opposite the gear" class="cons-img"/>
            <h3 class="cons-title">Discharge Fish Waste</h3>
          </div>
          <div class="cons-face cons-back">
            <h3>Discharge Fish Waste</h3>
            <p>Dump offal on the side opposite the baited line so scavenging birds stay away from hooks. This is required across parts of the western/central Pacific; the NOAA is studying results in Hawaii.</p>
          </div>
        </div>
      </button>

      <button class="cons-card" aria-label="Side-Setting (flip for details)">
        <div class="cons-card-inner">
          <div class="cons-face cons-front">
            <img src="images/placeholder-sideset.jpg" alt="Side-setting with bird curtain" class="cons-img"/>
            <h3 class="cons-title">Side-Setting</h3>
          </div>
          <div class="cons-face cons-back">
            <h3>Side-Setting</h3>
            <p>Set hooks from the vessel’s side near the bow and add weights close to hooks so they sink quickly. Paired with “bird curtains”, this setup sharply reduces seabird interactions.</p>
          </div>
        </div>
      </button>
    </div>
  </section>

  <!-- Transition: Conservation -> How to Help -->
  <section id="transition-cons-to-help" class="section transition-section">
    <div class="transition-content">
      <h2>Here’s how you can <strong>join in</strong> — small actions add up at sea.</h2>
    </div>
  </section>

  <!-- 11. How to Help -->
  <section id="how-to-help-section" class="section">
    <h1>How You Can Help</h1>
    <p class="subtitle">Here are 5 practical ways that YOU can support albatross conservation.</p>

    <div class="help-stage" data-nosnap>
      <div class="help-card">
        <aside class="help-tabs" role="tablist" aria-label="Ways to help">
          <button class="help-tab is-active" role="tab" aria-selected="true"  data-key="plastic">Avoid Plastic</button>
          <button class="help-tab"          role="tab" aria-selected="false" data-key="acap">Support ACAP</button>
          <button class="help-tab"          role="tab" aria-selected="false" data-key="kids">Read Kids’ Books</button>
          <button class="help-tab"          role="tab" aria-selected="false" data-key="donate">Donate or Adopt</button>
          <button class="help-tab"          role="tab" aria-selected="false" data-key="pelagic">See Them at Sea</button>
        </aside>
        <article class="help-content" aria-live="polite"></article>
      </div>
    </div>
  </section>

  <!-- 12. Sources -->
  <section id="sources-section" class="section">
    <h1>Sources & Further Reading</h1>
    <p class="subtitle">
      Key datasets, scientific papers, and accessible articles that informed this project.
    </p>

    <div class="sources-grid">
      <div class="source-card">
        <h3>Seabird Tracking Database</h3>
        <p>Global tracking data for albatrosses and other seabirds</p>
        <ul>
          <li>
            <a href="https://www.seabirdtracking.org/species/albatrosses/" target="_blank" rel="noopener">
              Seabird Tracking – Albatrosses
            </a>
          </li>
        </ul>
      </div>

      <div class="source-card">
        <h3>ACAP (Agreement on the Conservation of Albatrosses and Petrels)</h3>
        <p>International collaboration focused on conserving albatrosses and petrels</p>
        <ul>
          <li>
            <a href="https://data.acap.aq/" target="_blank" rel="noopener">
              ACAP Data Portal
            </a>
          </li>
        </ul>
      </div>

      <div class="source-card">
        <h3>BirdLife International</h3>
        <p>Global partnership of conservation organizations tracking seabird status and threats</p>
        <ul>
          <li>
            <a href="https://datazone.birdlife.org/species/factsheet" target="_blank" rel="noopener">
              BirdLife Data Zone – Species Factsheets
            </a>
          </li>
          <li>
            <a href="https://www.birdlife.org/news/2023/06/19/albatrosses-inspiring-legends-myths/" target="_blank" rel="noopener">
              Albatrosses Inspiring Legends & Myths
            </a>
          </li>
          <li>
            <a href="https://www.birdlife.org/campaigns-appeals/albatross-sos/#donate-form" target="_blank" rel="noopener">
              Albatross SOS Campaign
            </a>
          </li>
          <li>
            <a href="https://www.birdlife.org/news/2022/11/03/taking-action-for-albatrosses/" target="_blank" rel="noopener">
              Taking Action for Albatrosses
            </a>
          </li>
        </ul>
      </div>

      <div class="source-card">
        <h3>Cornell Lab of Ornithology – All About Birds</h3>
        <p>Accessible species accounts and conservation actions for bird enthusiasts</p>
        <ul>
          <li>
            <a href="https://www.allaboutbirds.org/guide/Laysan_Albatross/id" target="_blank" rel="noopener">
              Laysan Albatross Species Account
            </a>
          </li>
          <li>
            <a href="https://www.allaboutbirds.org/news/7-ways-you-can-help-albatrosses/" target="_blank" rel="noopener">
              7 Ways You Can Help Albatrosses
            </a>
          </li>
        </ul>
      </div>

      <div class="source-card">
        <h3>Scientific Research & Reviews</h3>
        <p>Primary literature on albatross flight, ecology, and conservation</p>
        <ul>
          <li>
            <a href="https://www.sciencedirect.com/science/article/pii/S0006320725000023" target="_blank" rel="noopener">
              ScienceDirect – Albatross Conservation Paper
            </a>
          </li>
          <li>
            <a href="https://www.int-res.com/articles/meps_oa/m672p205.pdf" target="_blank" rel="noopener">
              Marine Ecology Progress Series – Albatross Study
            </a>
          </li>
          <li>
            <a href="https://www.whoi.edu/press-room/news-release/new-research-unlocks-clues-about-the-iconic-flight-of-the-wandering-albatross/" target="_blank" rel="noopener">
              WHOI – Flight of the Wandering Albatross
            </a>
          </li>
          <li>
            <a href="https://spectrum.ieee.org/the-nearly-effortless-flight-of-the-albatross" target="_blank" rel="noopener">
              IEEE Spectrum – Nearly Effortless Flight of the Albatross
            </a>
          </li>
        </ul>
      </div>

      <div class="source-card">
        <h3>NOAA Fisheries</h3>
        <p>Policy and gear innovations that reduce albatross bycatch in US fisheries</p>
        <ul>
          <li>
            <a href="https://www.fisheries.noaa.gov/feature-story/6-ways-us-fisheries-reduce-albatross-bycatch" target="_blank" rel="noopener">
              6 Ways U.S. Fisheries Reduce Albatross Bycatch
            </a>
          </li>
        </ul>
      </div>

      <div class="source-card">
        <h3>Oceanic Society</h3>
        <p>Conservation programs and other ways to help</p>
        <ul>
          <li>
            <a href="https://www.oceanicsociety.org/adopt/adopt-an-albatross/" target="_blank" rel="noopener">
              Adopt an Albatross
            </a>
          </li>
        </ul>
      </div>

      <div class="source-card">
        <h3>Expeditions & Wildlife Guides</h3>
        <p>Natural history and travel-oriented perspectives on albatrosses</p>
        <ul>
          <li>
            <a href="https://poseidonexpeditions.com/about/articles/wandering-albatross/" target="_blank" rel="noopener">
              Poseidon Expeditions – Wandering Albatross
            </a>
          </li>
          <li>
            <a href="https://www.nathab.com/know-before-you-go/antarctica/wildlife-guide/albatrosses" target="_blank" rel="noopener">
              Natural Habitat Adventures – Albatross Wildlife Guide
            </a>
          </li>
        </ul>
      </div>
    </div>
  </section>

  <!-- 13. Credits -->
  <section id="credits-section" class="section">
    <div id="credits-inner">
      <img src="images/albatross-clipart.png" alt="Albatross illustration">
      <p class="credit-name">Robin Pan</p>
      <p class="credit-name">Audrey Zhang</p>
    </div>
  </section>


  <!-- Side Navigation Dots -->
  <div class="nav-dots">
    <div class="nav-dot active" data-section="home"     data-label="Home"></div>
    <div class="nav-dot"        data-section="intro"    data-label="Intro"></div>
    <div class="nav-dot"        data-section="quiz"     data-label="Quiz"></div>
    <div class="nav-dot"        data-section="map"      data-label="Map"></div>
    <div class="nav-dot"        data-section="flight"   data-label="Flight"></div>
    <div class="nav-dot"        data-section="anatomy"  data-label="Anatomy"></div>
    <div class="nav-dot"        data-section="species"  data-label="Species"></div>
    <div class="nav-dot"        data-section="folklore" data-label="Folklore"></div>
    <div class="nav-dot"        data-section="threats"  data-label="Threats"></div>
    <div class="nav-dot"        data-section="conserv"  data-label="Conservation"></div>
    <div class="nav-dot"        data-section="help"     data-label="How to Help"></div>
    <div class="nav-dot"        data-section="sources"  data-label="Sources"></div>
    <div class="nav-dot"        data-section="credits"  data-label="Credits"></div>
  </div>

  <!-- Right Panel for Species Info -->
  <div id="species-panel" data-nosnap>
    <button id="species-panel-close">×</button>
    <div id="species-panel-content">
      <h2 id="species-panel-title">Select a species</h2>
      <img id="species-panel-image" alt="" style="display:none;" />
      <div id="species-panel-info"></div>
      <div id="species-panel-map-container">
        <h3>Colony Locations</h3>
        <svg id="species-panel-map"></svg>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="intro.js"></script>
  <script src="visualization.js"></script>
  <script src="threats.js"></script>
  <script type="module" src="js/myths.js"></script>
  <script type="module" src="js/species-panel.js"></script>
  
  <!-- Quiz functionality, distance map, nav dots, AND smart snap scroll -->
  <script>
    /* ---------- Quiz ---------- */
    document.addEventListener('DOMContentLoaded', function() {
      const quizInput = document.getElementById('quiz-input');
      const quizSubmit = document.getElementById('quiz-submit');
      const quizAnswer = document.getElementById('quiz-answer');
      const quizContinue = document.getElementById('quiz-continue');
      const speciesSection = document.getElementById('distance-section');

      function showAnswer() {
        const userAnswer = parseInt(quizInput.value.trim());
        const isExact = userAnswer === 46;
        const isClose = userAnswer >= 40 && userAnswer <= 50;
        
        quizSubmit.disabled = true;
        quizInput.disabled = true;
        
        const answerTitle = quizAnswer.querySelector('h3');
        const answerText = quizAnswer.querySelector('p');
        
        if (isExact) {
          quizAnswer.classList.add('correct'); quizAnswer.classList.remove('incorrect');
          answerTitle.textContent = 'Correct! Just 46 days!';
          answerText.textContent = 'Albatrosses are incredible long-distance fliers, covering thousands of miles with minimal energy expenditure. They can spend months at sea without touching land!';
        } else if (isClose) {
          quizAnswer.classList.add('correct'); quizAnswer.classList.remove('incorrect');
          answerTitle.textContent = 'Close guess! The answer is 46 days.';
          answerText.textContent = 'Albatrosses are incredible long-distance fliers, covering thousands of miles with minimal energy expenditure. They can spend months at sea without touching land!';
        } else {
          quizAnswer.classList.add('incorrect'); quizAnswer.classList.remove('correct');
          answerTitle.textContent = 'Not quite! The answer is 46 days.';
          answerText.textContent = 'Albatrosses are incredible long-distance fliers, covering thousands of miles with minimal energy expenditure. They can spend months at sea without touching land!';
        }
        
        quizAnswer.classList.add('visible');
        setTimeout(() => { quizContinue.classList.add('visible'); }, 500);
      }

      quizSubmit.addEventListener('click', function() {
        if (quizInput.value.trim() !== '') showAnswer();
      });
      quizInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter' && quizInput.value.trim() !== '') showAnswer();
      });
      quizContinue.addEventListener('click', function() {
        speciesSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
      });
      quizInput.addEventListener('input', function() {
        quizSubmit.disabled = quizInput.value.trim() === '';
      });
      quizSubmit.disabled = true;
    });

    /* ---------- Distance map (Leaflet) ---------- */
    document.addEventListener('DOMContentLoaded', function() {
      const mapContainer = document.getElementById('distance-map');
      if (!mapContainer) return;

      const bostonCoords = [42.3601, -71.0589];
      const map = L.map('distance-map').setView(bostonCoords, 6);

      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '© OpenStreetMap contributors'
      }).addTo(map);

      const redIcon = L.icon({
        iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-red.png',
        shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
        iconSize: [25, 41], iconAnchor: [12, 41], popupAnchor: [1, -34], shadowSize: [41, 41]
      });

      // Add Boston marker with red icon
      const bostonMarker = L.marker(bostonCoords, {icon: redIcon})
        .addTo(map)
        .bindPopup('<b>Boston, MA</b>')
        .openPopup();

      // Add 560-mile radius circle (560 miles = ~901 km)
      const radiusCircle = L.circle(bostonCoords, {
        color: '#ef4444',
        fillColor: '#ef4444',
        fillOpacity: 0.1,
        radius: 901000, // 560 miles in meters
        dashArray: '10, 10'
      }).addTo(map);

      // Store city markers for updates
      let cityMarkers = [];

      function calculateDistance(lat1, lon1, lat2, lon2) {
        const R = 3959;
        const dLat = (lat2 - lat1) * Math.PI / 180;
        const dLon = (lon2 - lon1) * Math.PI / 180;
        const a = Math.sin(dLat/2)**2 +
                  Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                  Math.sin(dLon/2)**2;
        const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
        return R * c;
      }

      const citiesInRange = [
        { name: 'New York, NY', coords: [40.7128, -74.0060] },
        { name: 'Philadelphia, PA', coords: [39.9526, -75.1652] },
        { name: 'Washington, DC', coords: [38.9072, -77.0369] },
        { name: 'Montreal, Canada', coords: [45.5017, -73.5673] },
        { name: 'Portland, ME', coords: [43.6591, -70.2553] },
        { name: 'Buffalo, NY', coords: [42.8864, -78.8784] },
        { name: 'Pittsburgh, PA', coords: [40.4406, -79.9959] },
        { name: 'Richmond, VA', coords: [37.5407, -77.4360] }
      ];

      // Add city markers with flight time calculations
      citiesInRange.forEach(city => {
        const distance = calculateDistance(bostonCoords[0], bostonCoords[1], city.coords[0], city.coords[1]);
        const flightTimeHours = distance / 45;
        const hours = Math.floor(flightTimeHours);
        const minutes = Math.round((flightTimeHours - hours) * 60);
        let timeText;
        if (hours === 0) timeText = `${minutes} minutes`;
        else if (minutes === 0) timeText = `${hours} hour${hours > 1 ? 's' : ''}`;
        else timeText = `${hours} hour${hours > 1 ? 's' : ''} ${minutes} minutes`;

        L.marker(city.coords).addTo(map)
          .bindPopup(`<b>${city.name}</b><br>Distance: ${Math.round(distance)} miles<br>Flight time: ${timeText}`)
          .on('mouseover', function(){ this.openPopup(); });
      });

      const distanceInfo = L.control({position: 'topright'});
      distanceInfo.onAdd = function() {
        const div = L.DomUtil.create('div', 'distance-info-control');
        div.style.backgroundColor = 'white';
        div.style.padding = '10px';
        div.style.borderRadius = '5px';
        div.style.boxShadow = '0 2px 5px rgba(0,0,0,0.2)';
        div.innerHTML = '<b>Albatross Daily Range</b><br>560 miles from Boston';
        return div;
      };
      distanceInfo.addTo(map);

      // Fit map to show the circle and all cities
      const group = new L.featureGroup([radiusCircle, bostonMarker, ...citiesInRange.map(city => L.marker(city.coords))]);
      map.fitBounds(group.getBounds().pad(0.1));
    });

    /* ---------- Side navigation dots ---------- */
    document.addEventListener('DOMContentLoaded', function() {
      const navDots = document.querySelectorAll('.nav-dot');
      const sections = {
        home    : document.getElementById('landing-section'),
        intro   : document.getElementById('welcome'),
        quiz    : document.getElementById('quiz-section'),
        map     : document.getElementById('distance-section'),
        flight  : document.getElementById('scatter-section'),
        anatomy : document.getElementById('intro-section'),
        species : document.getElementById('species-section'),
        folklore: document.getElementById('myths-section'),
        threats : document.getElementById('threats-section'),
        conserv : document.getElementById('conservation-section'),
        help    : document.getElementById('how-to-help-section'),
        sources : document.getElementById('sources-section'),
        credits : document.getElementById('credits-section')
      };

      navDots.forEach(dot => {
        dot.addEventListener('click', function() {
          const key = this.getAttribute('data-section');
          const el = sections[key];
          if (el) el.scrollIntoView({ behavior: 'smooth', block: 'start' });
        });
      });

      function updateActiveDot() {
        const mid = window.scrollY + window.innerHeight / 2;
        let activeKey = 'home';
        Object.entries(sections).forEach(([k, el]) => {
          if (!el) return;
          const t = el.offsetTop, b = t + el.offsetHeight;
          if (mid >= t && mid < b) activeKey = k;
        });
        navDots.forEach(d => d.classList.toggle('active', d.getAttribute('data-section') === activeKey));
      }
      window.addEventListener('scroll', updateActiveDot);
      updateActiveDot();
    });
  </script>
</body>
</html>
