<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Albatross Exploration</title>
  <link rel="stylesheet" href="styles.css"/>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <style>
  :root{
    --ink:#0f172a;
    --ink-2:#1f2937;
    --muted:#6b7280;
    --chip:#f3f4f6;
    --chip-b:#e5e7eb;
    --chip-act:#e8f0ff;
    --chip-act-b:#bfdbfe;

    /* shared sizing used by map + myths */
    --panel-h: 500px;
    --panel-w: 900px;
  }

  body{ 
    margin:0; 
    font-family: ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif; 
    background:#dbf0fe; 
    color:var(--ink); 
  }

  /* Section styling */
  .section {
    padding: 60px 20px;
    max-width: 1400px;
    margin: 0 auto;
  }

  .section h1 {
    font-size: 32px;
    text-align: center;
    margin-bottom: 10px;
    color: #2c3e50;
  }

  .section .subtitle {
    text-align: center;
    color: var(--muted);
    margin-bottom: 30px;
    font-size: 18px;
  }

  /* Intro section */
  #intro-section { background: #dbf0fe; }

  #intro-visual {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 20px 0;
  }

  #intro-visual svg {
    width: min(95vw, 1100px);
    height: auto;
    display: block;
  }

  .wing-hotspot{ fill: rgba(0,0,0,0); cursor:pointer; }
  .wing-hotspot:hover{ fill: rgba(0,0,0,0.06); }
  .stomach-hotspot{ fill: rgba(0,0,0,0); cursor:pointer; }
  .stomach-hotspot:hover{ fill: rgba(255,165,0,0.12); }
  .beak-hotspot{ fill: rgba(0,0,0,0); cursor:pointer; }
  .beak-hotspot:hover{ fill: rgba(255,99,71,0.12); }

    /* Quiz section */
    #quiz-section {
      background: #dbf0fe;
      display: flex;
      flex-direction: column;
      align-items: center;
      /* Place content toward the top of the section and add extra top padding
         so the quiz appears lower on the page visually. */
      justify-content: flex-start;
      min-height: 80vh;
      padding: 140px 20px 60px;
    }

  #quiz-container {
    max-width: 600px;
    text-align: center;
    padding: 40px;
  }

  #quiz-question {
    font-size: 22px;
    font-weight: 600;
    color: #2c3e50;
    margin-bottom: 30px;
    line-height: 1.4;
  }

  #quiz-input-container { margin: 30px 0; position: relative; }

  #quiz-input {
    width: 100%;
    padding: 15px 20px;
    font-size: 18px;
    border: 3px solid #e5e7eb;
    border-radius: 12px;
    outline: none;
    transition: border-color 0.3s ease;
    font-family: inherit;
  }

  #quiz-input:focus {
    border-color: #2563eb;
    box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
  }

  #quiz-submit {
    margin-top: 20px;
    padding: 12px 30px;
    font-size: 18px;
    font-weight: 600;
    background: #2563eb;
    color: white;
    border: none;
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  #quiz-submit:hover { background: #1d4ed8; transform: translateY(-2px); }
  #quiz-submit:disabled { background: #94a3b8; cursor: not-allowed; transform: none; }

  #quiz-answer {
    margin-top: 30px;
    padding: 20px;
    background: #ecfdf5;
    border: 2px solid #10b981;
    border-radius: 12px;
    opacity: 0;
    transform: translateY(20px);
    transition: all 0.5s ease;
  }

  #quiz-answer.correct { background: #ecfdf5; border-color: #10b981; }
  #quiz-answer.incorrect { background: #fef2f2; border-color: #ef4444; }
  #quiz-answer.visible { opacity: 1; transform: translateY(0); }

  #quiz-answer h3 { color: #047857; font-size: 24px; margin: 0 0 10px 0; }
  #quiz-answer.incorrect h3 { color: #dc2626; }

  #quiz-answer p { color: #065f46; font-size: 16px; margin: 0; line-height: 1.6; }
  #quiz-answer.incorrect p { color: #991b1b; }

  #quiz-continue {
    margin-top: 25px;
    padding: 12px 25px;
    font-size: 16px;
    font-weight: 600;
    background: #047857;
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
    opacity: 0;
    transform: translateY(10px);
  }

  #quiz-continue.visible { opacity: 1; transform: translateY(0); }
  #quiz-continue:hover { background: #065f46; transform: translateY(-1px); }
  #quiz-answer.incorrect #quiz-continue { background: #dc2626; }
  #quiz-answer.incorrect #quiz-continue:hover { background: #b91c1c; transform: translateY(-1px); }

  /* Distance section */
  #distance-section { background: #dbf0fe; }

  #distance-container {
    max-width: var(--panel-w);
    margin: 0 auto;
    text-align: center;
  }

  #distance-info {
    font-size: 24px;
    color: #2c3e50;
    margin-bottom: 30px;
    font-weight: 600;
  }

  #distance-map {
    width: 100%;
    height: var(--panel-h) !important;
    border: 2px solid #dbf0fe;
    border-radius: 12px;
    margin: 20px 0;
    z-index: 1;
  }

  /* Leaflet map custom styles */
  .distance-info-control { font-family: inherit; font-size: 14px; line-height: 1.4; }
  .leaflet-popup-content { font-family: inherit; font-size: 13px; }

  /* Species section */
  #species-section { background: #dbf0fe; }

  #species-legend {
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
    gap: 12px;
    margin-bottom: 20px;
    padding: 10px;
  }

  .legend-item { display: flex; align-items: center; gap: 8px; font-size: 16px; color: #2c3e50; }
  .legend-circle { width: 20px; height: 20px; border-radius: 50%; border: 10px solid; }

  #species-visualization { position: relative; width: 100%; min-height: 800px; }

  .bird-icon { fill: #34495e; }
  .status-ring { fill: none; stroke-width: 10; }
  .bird-label { font-size: 18px; fill: #2c3e50; text-anchor: middle; font-weight: 500; }

  .fact-card {
    position: absolute;
    background: white;
    border: 2px solid #2c3e50;
    border-radius: 8px;
    padding: 15px;
    max-width: 350px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.2s;
    z-index: 1000;
    font-size: 14px;
  }

  .fact-card.visible { opacity: 1; }
  .fact-card h3 { margin: 0 0 10px 0; color: #2c3e50; font-size: 18px; }
  .fact-card .fun-fact { background: #f0f8ff; padding: 10px; border-radius: 4px; margin-bottom: 10px; font-style: italic; color: #34495e; }
  .fact-card .stat { margin: 5px 0; color: #555; }
  .fact-card .stat strong { color: #2c3e50; }

  /* Threats section */
  #threats-section { background: #dbf0fe; }

  #matrix-viz {
    overflow-x: auto;
    overflow-y: visible;
    display: flex;
    justify-content: center;
    width: 100%;
  }

  #matrix-viz svg { max-width: 100%; }

  .species-label{ font-size:13px; fill:#2c3e50; text-anchor:end; }
  .threat-label{ font-size:12px; fill:#2c3e50; text-anchor:start; }
  .matrix-circle{ cursor:pointer; }
  .grid-line{ stroke:none; }

  .threats-legend {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin-bottom: 20px;
    flex-wrap: wrap;
    align-items: center;
  }

  .threats-legend-item { display: flex; align-items: center; gap: 8px; font-size: 14px; }
  .threats-legend-circle { border-radius: 50%; background: #888; }

  /* ===================== Myths section (updated) ===================== */
  #myths-section { background: #dbf0fe; }

  /* base postcard shell (general) */
  .pc-stage {
    position: relative;
    border: 1px solid var(--chip-b);
    border-radius: 14px;
    background: #fff;
    overflow: hidden;
    box-shadow: 0 8px 24px rgba(0,0,0,.05);
  }
  .pc-viewport {
    overflow-x: auto;
    overflow-y: hidden;
    scroll-snap-type: x mandatory;
    scroll-behavior: smooth;
    scrollbar-width: none;
  }
  .pc-viewport::-webkit-scrollbar { display: none; }
  .pc-track { display: flex; gap: 18px; padding: 18px; }

  .pc-card {
    flex: 0 0 100%;
    scroll-snap-align: start;
    border: 2px solid #0f172a;
    border-radius: 12px;
    background: #fff;
    box-shadow: 0 10px 24px rgba(0,0,0,.06);
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 0;
    width: 100%;
    height: var(--panel-h);
    overflow: hidden;
  }

  .pc-left, .pc-right { min-height: 0; overflow-y: auto; }

  .pc-lines { display: none; }

  .pc-kicker {
    margin: 0 0 16px 0;
    font-size: 14px;
    color: #64748b;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    font-weight: 600;
  }

  .pc-text p {
    margin: 0 0 12px 0;
    font-size: 18px;
    line-height: 1.6;
    color: #0b1220;
  }
  .pc-text p:last-child { margin-bottom: 16px; }

  .pc-divider { display: none; }

  .pc-right {
    position: relative;
    padding: 20px;
    display: flex;
    flex-direction: column;
    gap: 8px;
    border-left: 1px solid #e5e7eb;
    flex: 1;
  }

  .pc-meta {
    align-self: start;
    margin-top: 0;
    flex-shrink: 0;
    margin-bottom: 12px;
  }

  .pc-title { font-weight: 800; font-size: 24px; margin-bottom: 8px; line-height: 1.2; }
  .pc-country { font-weight: 700; color: #334155; margin-bottom: 6px; font-size: 15px; }
  .pc-source { font-size: 13px; color: #94a3b8; }

  .pc-hero {
    width: 100%;
    height: auto;
    max-height: 400px;
    background-size: cover;
    background-position: center;
    border-radius: 6px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    flex: 1;
  }
  .pc-hero.pc-hero-ph { background: linear-gradient(135deg, #eef2ff, #e0e7ff); }

  .pc-quote {
    margin: 16px 0 0 0;
    padding: 8px;
    background: #f1f5f9;
    border-left: 2px solid #64748b;
    font-style: italic;
    color: #334155;
    font-size: 16px;
    line-height: 1.5;
  }
  .pc-quote-attr { font-size: 12px; color: #94a3b8; margin-top: 4px; }

  .carousel-btn {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    z-index: 5;
    width: 46px;
    height: 46px;
    border-radius: 999px;
    border: 1px solid var(--chip-b);
    background: #fff;
    box-shadow: 0 6px 16px rgba(0,0,0,.12);
    font-size: 28px;
    line-height: 1;
    color: #0f172a;
    cursor: pointer;
  }
  .carousel-btn:hover { background: var(--chip-act); cursor: pointer; }
  .carousel-btn.prev { left: -56px; }
  .carousel-btn.next { right: -56px; }

  /* .pc-footer {
    margin-top: 10px;
    margin-bottom: 40px;
    display: flex;
    gap: 12px;
    align-items: center;
    justify-content: center;
  } */

  #myths-section .pc-footer,
  #myths-section #pcCounter,
  #myths-section .hint,
  #myths-section .pc-dots {
    display: none !important;
  }
  /* .pc-counter { font-weight: 600; color: #334155; } */

  /* ---------- Myths overrides (scoped) ---------- */
  /* match distance map width/height, hide next-card peek, smaller type */
  #myths-section .pc-stage{
    max-width: var(--panel-w);
    width: 100%;
    margin: 0 auto;
    padding: 18px;
    height: var(--panel-h) !important;
    overflow: visible !important;
  }

  #myths-section .pc-viewport{
    width: 100%;
    height: 100% !important;
    overflow-x: hidden;   /* hide next card completely */
    overflow-y: hidden;
    scroll-snap-type: x mandatory;
    scroll-padding: 0;
    border-radius: 12px;
  }
  #myths-section .pc-viewport::-webkit-scrollbar{ display:none; }

  #myths-section .pc-track{
    height: 100% !important;
    width: 100%;
    gap: 0 !important;    /* remove inter-card sliver */
    padding: 0 !important;
  }

  #myths-section .pc-card{
    flex: 0 0 100%;
    width: 100%;
    height: 100% !important;
    border: none !important;
    box-shadow: 0 10px 24px rgba(0,0,0,.06);
    /*box-sizing: border-box;*/
    margin: 0;
    overflow: hidden;
    /* smaller typography just for myths */
    --pc-body: 15px;
    --pc-kicker: 12px;
    --pc-title: 20px;
    --pc-country: 13px;
    --pc-source: 12px;
    --pc-quote: 14px;
  }

  #myths-section .pc-left,
  #myths-section .pc-right{ min-height: 0; overflow-y: auto; }

  #myths-section .pc-right{ display:flex; flex-direction:column; }

  #myths-section .pc-meta,
  #myths-section .pc-title,
  #myths-section .pc-country,
  #myths-section .pc-source,
  #myths-section .pc-quote{ flex-shrink:0; }

  #myths-section .pc-hero{
    flex: 1 1 auto;
    min-height: 0;
    max-height: 100%;
    background-size: cover;
    background-position: center;
  }
  #myths-section .pc-hero img{
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
  }

  /* smaller text application */
  #myths-section .pc-text p{ font-size: var(--pc-body) !important; line-height: 1.55 !important; }
  #myths-section .pc-kicker{ font-size: var(--pc-kicker) !important; letter-spacing: .4px; }
  #myths-section .pc-title{ font-size: var(--pc-title) !important; }
  #myths-section .pc-country{ font-size: var(--pc-country) !important; }
  #myths-section .pc-source{ font-size: var(--pc-source) !important; }
  #myths-section .pc-quote{ font-size: var(--pc-quote) !important; line-height: 1.45; }
  #myths-section .pc-quote-attr{ font-size: 12px !important; color: #94a3b8; }
  #myths-section .pc-left, 
  #myths-section .pc-right{ padding: 14px !important; }

  /* Tooltip */
  .tooltip {
    position: absolute;
    background: rgba(0,0,0,.85);
    color: #fff;
    padding: 6px 8px;
    border-radius: 4px;
    font-size: 14px;
    pointer-events: none;
    z-index: 9999;
    display: none;
  }

  /* Right Panel */
  #species-panel {
    position: fixed;
    top: 0;
    right: -450px;
    width: 450px;
    height: 100vh;
    background: white;
    box-shadow: -4px 0 20px rgba(0,0,0,0.15);
    transition: right 0.3s ease;
    z-index: 1000;
    overflow-y: auto;
    padding: 20px;
  }

  #species-panel.open { right: 0; }

  #species-panel-close {
    position: absolute;
    top: 10px;
    right: 10px;
    background: none;
    border: none;
    font-size: 28px;
    cursor: pointer;
    color: var(--ink);
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    transition: background 0.2s;
  }
  #species-panel-close:hover { background: #f3f4f6; }

  #species-panel-content h2 { margin-top: 0; margin-bottom: 10px; color: #2c3e50; font-size: 24px; }
  #species-panel-content h3 { margin: 15px 0 5px 0; color: #2c3e50; font-size: 18px; }

  #species-panel-image {
    width: 100%;
    max-width: 400px;
    height: auto;
    border-radius: 8px;
    margin: 15px 0;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  }

  #species-panel-info { margin: 20px 0; }
  #species-panel-info p { margin: 8px 0; line-height: 1.6; }
  #species-panel-info .info-label { font-weight: 600; color: #2c3e50; }

  #species-panel-map-container {
    margin-top: 30px;
    border-top: 2px solid #e5e7eb;
    padding-top: 20px;
  }

  #species-panel-map {
    width: 100%;
    height: 350px;
    border: 1px solid var(--chip-b);
    border-radius: 8px;
    background: #e6f3ff;
  }

  .colony {
    fill: #2563eb;
    fill-opacity: 0.88;
    stroke: #0f172a;
    stroke-width: 0.5;
    stroke-opacity: 0.25;
    cursor: pointer;
  }

  .colony.highlight {
    stroke-width: 2;
    stroke-opacity: 0.8;
    filter: drop-shadow(0 0 4px rgba(37,99,235,0.6));
  }

  .country { fill: #f1efe8; stroke: #94a3b8; stroke-width: 0.6; }
  .graticule { fill: none; stroke: #bfdbfe; stroke-width: 0.5; opacity: 0.6; }

  /* Navigation Dots */
  .nav-dots {
    position: fixed;
    right: 20px;
    top: 50%;
    transform: translateY(-50%);
    z-index: 1000;
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  .nav-dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background: rgba(44, 62, 80, 0.3);
    border: 2px solid rgba(44, 62, 80, 0.5);
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
  }

  .nav-dot:hover { background: rgba(44, 62, 80, 0.6); transform: scale(1.2); }
  .nav-dot.active { background: #2c3e50; border-color: #2c3e50; transform: scale(1.3); }

  .nav-dot::after {
    content: attr(data-label);
    position: absolute;
    right: 25px;
    top: 50%;
    transform: translateY(-50%);
    background: rgba(44, 62, 80, 0.9);
    color: white;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 12px;
    white-space: nowrap;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease;
  }
  .nav-dot:hover::after { opacity: 1; }

  /* Hide nav dots on mobile */
  @media (max-width: 768px) { .nav-dots { display: none; } }

  /* Responsive */
  @media (max-width: 980px) { .pc-card { min-height: auto; } }

  @media (max-width: 760px) {
    .pc-card { grid-template-columns: 1fr; }
    .pc-right { border-left: none; border-top: 1px solid #e5e7eb; }
    .pc-hero { max-height: 200px; }
    .pc-left { padding: 10px; }
    .pc-right { padding: 10px; }
  }

  /* ===== Conservation Efforts grid (updated image/text ratio) ===== */
  #conservation-section .cons-grid {
    max-width: var(--panel-w);
    margin: 0 auto;
    display: grid;
    grid-template-columns: repeat(3, minmax(0,1fr));
    gap: 16px;
  }

  #conservation-section .cons-card {
    position: relative;
    width: 100%;
    height: 280px;                 /* keep overall height the same */
    border-radius: 12px;
    background: #fff;
    box-shadow: 0 6px 16px rgba(0,0,0,.08);
    cursor: pointer;
    padding: 0;
    outline: none;
    perspective: 1000px;
    border: none;
    transition: box-shadow .2s ease, transform .06s ease;
  }
  #conservation-section .cons-card:hover { box-shadow: 0 10px 24px rgba(0,0,0,.12); }
  #conservation-section .cons-card:active { transform: translateY(1px); }

  #conservation-section .cons-card-inner {
    position: absolute;
    inset: 0;
    border-radius: 12px;
    transform-style: preserve-3d;
    transition: transform .55s ease;
  }

  /* faces */
  #conservation-section .cons-face {
    position: absolute;
    inset: 0;
    backface-visibility: hidden;
    border-radius: 12px;
    overflow: hidden;
    display: flex;
    flex-direction: column;
  }

  /* FRONT — make image big, label strip small */
  #conservation-section .cons-front { background: #fff; }

  /* bigger image: ~85% of card height */
  #conservation-section .cons-img {
    width: 100%;
    height: 85%;
    object-fit: cover;
    object-position: center;        /* good crop */
    display: block;
  }

  /* slimmer label area */
  #conservation-section .cons-title {
    margin: 6px 12px 0 12px;        /* tighter margins */
    font-size: 15px;                /* a touch smaller */
    line-height: 1.2;
    font-weight: 800;
    text-align: center;
    flex: 1 0 auto;
  }

  /* BACK (flip) */
  #conservation-section .cons-back {
    background: #fff;
    transform: rotateY(180deg);
    padding: 16px;
    display: flex;
    flex-direction: column;
    align-items: center;       /* horizontal centering */
    justify-content: center;   /* vertical centering */
    text-align: center;        /* center text lines */
    gap: 8px;
  }

  #conservation-section .cons-back h3 {
    margin: 0;
    font-size: 15px;
    line-height: 1.25;
  }

  #conservation-section .cons-back p {
    margin: 0;
    font-size: 13px;
    line-height: 1.45;
    color: #334155;
    max-width: 90%;            /* optional: keep lines tidy */
  }

  /* flip state */
  #conservation-section .cons-card.is-flipped .cons-card-inner { transform: rotateY(180deg); }

  /* responsive: keep the image dominant */
  @media (max-width: 980px) {
    #conservation-section .cons-grid { grid-template-columns: repeat(2, minmax(0,1fr)); }
    #conservation-section .cons-card { height: 260px; }
    #conservation-section .cons-img { height: 82%; }
  }
  @media (max-width: 640px) {
    #conservation-section .cons-grid { grid-template-columns: 1fr; }
    #conservation-section .cons-card { height: 250px; }
    #conservation-section .cons-img { height: 80%; }
  }

</style>

</head>

<script>
  // Keep --panel-h equal to the current #distance-map height
  function syncPanelHeightToMap(){
    const dm = document.getElementById('distance-map');
    if(!dm) return;
    const h = Math.round(dm.getBoundingClientRect().height);
    document.documentElement.style.setProperty('--panel-h', h + 'px');
  }
  window.addEventListener('load', syncPanelHeightToMap);
  window.addEventListener('resize', syncPanelHeightToMap);

  // If your myths are rendered after the page loads, re-sync once more soon after
  setTimeout(syncPanelHeightToMap, 300);
</script>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    document.querySelectorAll('#conservation-section .cons-card').forEach(card => {
      // Make button act like a toggle
      card.addEventListener('click', () => {
        card.classList.toggle('is-flipped');
      });
      // Keyboard support
      card.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          card.classList.toggle('is-flipped');
        }
      });
    });
  });
</script>


<body>
  <!-- Landing Section -->
  <section id="landing-section" class="section" style="min-height: 100vh; display: flex; align-items: center; justify-content: center; background: #dbf0fe;">
    <h1 style="font-size: 64px; color: #2c3e50; margin: 0;">Wings Over Water: The Albatross</h1>
  </section>


  <!-- Intro Section -->
  <section id="intro-section" class="section">
    <h1>Anatomy of an Albatross</h1>
    <p class="subtitle">Click the highlighted regions (wings, stomach, beak) to see information.</p>
    <div id="intro-visual"></div>
  </section>

  <!-- Quiz Section -->
  <section id="quiz-section" class="section">
    <div id="quiz-container">
      <p style="font-size: 20px; color: #2c3e50; margin-bottom: 30px; line-height: 1.4; text-align: center;">In Around the World in 80 Days, the main character Phileas Fogg attemps to circumnavigate the globe in 80 days.</h2>
      <p style="font-size: 20px; color: #2c3e50; margin-bottom: 30px; line-height: 1.4; text-align: center;">Albatrosses regularly make this trip by wing, travelling over 13000 miles. Guess how many days this trip took:</p>
      <div id="quiz-input-container">
        <input type="text" id="quiz-input" placeholder="Enter your guess..." autocomplete="off">
        <button id="quiz-submit" type="button">Submit Answer</button>
      </div>
      <div id="quiz-answer">
        <h3>Just 46 days!</h3>
        <p>Albatrosses are incredible long-distance fliers, covering thousands of miles with minimal energy expenditure. They can spend months at sea without touching land! </p>
        <button id="quiz-continue" type="button">Continue Exploring →</button>
      </div>
    </div>
  </section>

  <!-- Distance Section -->
  <section id="distance-section" class="section">
    <div id="distance-container">
      <h1>All in a Day's Work</h1>
      <p class="subtitle">Albatrosses can travel up to 560 miles in a single day, traveling on average at 45 miles per hour. </p>
      <p class="subtitle">
        From Boston, this would reach as far as:
      <p>
      <div id="distance-map"></div>
    </div>
  </section>

  <!-- Inline 3D Scatter Visualization (embedded directly below "All in a Day's Work") -->
  <section id="scatter-section" class="section">
    <h1>Dynamic Soaring</h1>
    <p class="subtitle">Albatrosses are one of very few families of birds that utilize dynamic soaring, a special flying technique that takes advantage of ocean winds to fly without using much energy. The wind right above the waves is slow due to drag from the water and faster a few meters up. An albatross loops up and down through this wind gradient to grab free energy from the wind. One loop has four steps:</p>
    <div style="width:100%; display:flex; justify-content:center;">
      <div style="display:flex; gap:24px; width:100%; max-width:1200px; align-items:flex-start;">
        <!-- Left column: iframe occupying half the available width -->
        <div style="flex:1; min-width:0;">
          <iframe src="3d-scatter.html?zoom=2.7" style="width:100%;height:540px;border-radius:8px;border:1px solid rgba(0,0,0,0.12);background:#fff;box-shadow:0 6px 18px rgba(15,23,42,0.08);" allowfullscreen></iframe>
        </div>

        <!-- Right column: explanatory/context content -->
        <div id="scatter-text-col" style="flex:1; min-width:0; display:flex; flex-direction:column; gap:12px; align-items:flex-start;">
          <div id="box-1" class="scatter-info" style="background:#fff;padding:16px;border-radius:8px;border:1px solid #eef2ff; width:100%;">
            <h3 style="margin:0 0 8px 0; font-size:18px; color:#2c3e50;">1. Prepare to climb:</h3>
            <p class="small" style="margin:0 0 8px 0;"> The bird stays just a meter or two above the water, where the air moves more slowly. This lets it line up the next turn with very little effort.</p>
        </div>

        <div style="flex:1; min-width:0; display:flex; flex-direction:column; gap:12px; align-items:flex-start;">
          <div id="box-2" class="scatter-info" style="background:#fff;padding:16px;border-radius:8px;border:1px solid #eef2ff; width:100%;">
            <h3 style="margin:0 0 8px 0; font-size:18px; color:#2c3e50;">2. Climb into the wind:</h3>
            <p class="small" style="margin:0 0 8px 0;"> The albatrosses faces the wind while climbing a few to ~20 meters. As it crosses into the faster-moving air aloft, its airspeed through the air increases.</p>
        </div>

        <div style="flex:1; min-width:0; display:flex; flex-direction:column; gap:12px; align-items:flex-start;">
          <div id="box-3" class="scatter-info scatter-jump" data-jump-t="0.66" style="background:#fff;padding:16px;border-radius:8px;border:1px solid #eef2ff; width:100%; cursor:pointer;">
            <h3 style="margin:0 0 8px 0; font-size:18px; color:#2c3e50;">3. Turn back down:</h3>
            <p class="small" style="margin:0 0 8px 0;"> Once at the top, the albatross turns down against the wind in preperation for its descent downwards.</p>
        </div>

        <div style="flex:1; min-width:0; display:flex; flex-direction:column; gap:12px; align-items:flex-start;">
          <div id="box-4" class="scatter-info scatter-jump" data-jump-t="1.0" style="background:#fff;padding:16px;border-radius:8px;border:1px solid #eef2ff; width:100%; cursor:pointer;">
            <h3 style="margin:0 0 8px 0; font-size:18px; color:#2c3e50;">4. Glide down with the wind:</h3>
            <p class="small" style="margin:0 0 8px 0;"> The albatross glides downwards, facing away from the wind, and converts the potential energy gained from its upward climb into kinetic energy.<p>
      </div>
    </div>
  </section>
    </div>
  </section>

  <script>
    // Listen for highlight messages from the embedded scatter iframe
    window.addEventListener('message', (ev) => {
      if (!ev.data || typeof ev.data !== 'object') return;
      if (ev.data.type === 'highlight-box') {
        const box = Number(ev.data.box) || 0; // 1..4 expected
        const boxes = [document.getElementById('box-1'), document.getElementById('box-2'), document.getElementById('box-3'), document.getElementById('box-4')];
        for (let i = 0; i < boxes.length; i++) {
          const el = boxes[i];
          if (!el) continue;
          if (i === (box - 1)) {
            el.style.background = 'linear-gradient(90deg, #e8f0ff, #dbeafe)';
            el.style.borderColor = '#bfdbfe';
            el.style.boxShadow = '0 6px 18px rgba(37,99,235,0.08)';
            el.style.opacity = '1';
            el.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
          } else {
            el.style.background = '#f8fafc';
            el.style.borderColor = '#eef2ff';
            el.style.boxShadow = 'none';
            el.style.opacity = '0.6';
          }
        }
      }
    }, false);

    // Wire clicks on the .scatter-jump elements to postMessage to the iframe (jump-to)
    window.addEventListener('DOMContentLoaded', () => {
      const iframe = document.querySelector('iframe[src^="3d-scatter.html"]');
      if (!iframe) return;
      document.querySelectorAll('.scatter-jump').forEach(el => {
        el.style.cursor = 'pointer';
        el.addEventListener('click', () => {
          const t = parseFloat(el.dataset.jumpT || '0');
          iframe.contentWindow.postMessage({ type: 'jump-to-t', t: t }, '*');
        });
      });
    });
  </script>

  <!-- Info: shared feats across the genus (between Distance and Species) -->
  <section id="info-genus-section" class="section transition-section">
    <div class="transition-content">
      <h2>These flight feats are shared across the genus — but the albatross isn’t just one bird. <strong>22 recognized species</strong> share the same winds of flight but ride them in their own ways.</h2>
    </div>
  </section>

  <!-- Species Section -->
  <section id="species-section" class="section">
    <h1>Exploring By The Species</h1>
    <p class="subtitle">Click on each species for more information!</p>
    <div id="species-legend"></div>
    <div id="species-visualization"></div>
  </section>

  <!-- Transition Section 4 -->
  <section id="transition-4-section" class="section transition-section">
    <div class="transition-content">
      <h2>Where distance is the albatross' shared trademark, <strong>the wind</strong> is their highway.</h2>
    </div>
  </section>

  <!-- Blank: An Albatross in Flight (content to come) -->
  <section id="flight-section" class="section" style="min-height: 80vh; display:flex; align-items:center; justify-content:center;">
    <h1>An Albatross in Flight</h1>
  </section>

  <!-- Info: folklore intro (before Myths) -->
  <section id="info-folklore-section" class="section transition-section">
    <div class="transition-content">
      <h2>For millennia, the same winds that guided albatrosses also guided sailors and inspired stories. Indeed, albatrosses soon became <strong>an omen, a muse, and a myth.</strong></h2>
    </div>
  </section>

  <!-- Myths Section -->
  <section id="myths-section" class="section">
    <h1>Folklore & Superstitions</h1>
    <p class="subtitle">Flip through famous appearances of the albatross in literature and history.</p>
    <div class="pc-stage">
      <button id="prevBtn" class="carousel-btn prev" aria-label="Previous story" title="Previous">‹</button>
      <div id="pcViewport" class="pc-viewport" aria-label="Postcard viewport">
        <div id="pcTrack" class="pc-track" role="list"></div>
      </div>
      <button id="nextBtn" class="carousel-btn next" aria-label="Next story" title="Next">›</button>
      <div class="pc-footer">
        <span id="pcCounter" class="pc-counter">—</span>
        <span class="hint">Use arrows or swipe to explore.</span>
      </div>
    </div>
  </section>

  <script>
  (function(){
    function lockMythsHeight(){
      const map = document.getElementById('distance-map');
      const h = map ? Math.round(map.getBoundingClientRect().height) : null;
      const stage = document.querySelector('#myths-section .pc-stage');
      const cards = document.querySelectorAll('#myths-section .pc-card');
      if(stage && h){ stage.style.height = h + 'px'; }
      cards.forEach(c => { c.style.height = (h || getComputedStyle(stage).height) ; });
    }

    // run after load and on resize
    window.addEventListener('load', lockMythsHeight);
    window.addEventListener('resize', lockMythsHeight);

    // if myths.js injects cards later, re-apply
    const track = document.getElementById('pcTrack');
    if(track){
      const mo = new MutationObserver(lockMythsHeight);
      mo.observe(track, { childList: true, subtree: true });
    }
  })();
  </script>

  <!-- Transition Section 1 -->
  <section id="transition-1-section" class="section transition-section">
    <div class="transition-content">
      <h2>Unfortunately, the winds that albatrosses follow now carry <strong>new hazards</strong>.</h2>
    </div>
  </section>

  <section id="threats-section" class="section">
    <h1>Threats</h1>
    <p class="subtitle">Each circle represents a threat affecting a species. Hover for details.</p>
    
    <!-- Conservation Status Legend -->
    <div style="margin-bottom: 15px;">
      <div style="text-align: center; font-weight: 600; margin-bottom: 10px; color: #2c3e50;">Conservation Status</div>
      <div class="threats-legend">
        <div class="threats-legend-item">
          <div class="threats-legend-circle" style="width:12px; height:12px; background:#DD403A;"></div>
          <span>Critically Endangered</span>
        </div>
        <div class="threats-legend-item">
          <div class="threats-legend-circle" style="width:12px; height:12px; background:#FF7B3D;"></div>
          <span>Endangered</span>
        </div>
        <div class="threats-legend-item">
          <div class="threats-legend-circle" style="width:12px; height:12px; background:#FFC34B;"></div>
          <span>Vulnerable</span>
        </div>
        <div class="threats-legend-item">
          <div class="threats-legend-circle" style="width:12px; height:12px; background:#5AB361;"></div>
          <span>Near Threatened</span>
        </div>
        <div class="threats-legend-item">
          <div class="threats-legend-circle" style="width:12px; height:12px; background:#2F6690;"></div>
          <span>Least Concern</span>
        </div>
      </div>
    </div>
    
    <!-- Threat Impact Legend -->
    <div style="margin-bottom: 20px;">
      <div style="text-align: center; font-weight: 600; margin-bottom: 10px; color: #2c3e50;">Threat Impact</div>
      <div class="threats-legend">
        <div class="threats-legend-item">
          <div class="threats-legend-circle" style="width:24px; height:24px;"></div>
          <span>High Impact</span>
        </div>
        <div class="threats-legend-item">
          <div class="threats-legend-circle" style="width:18px; height:18px;"></div>
          <span>Medium Impact</span>
        </div>
        <div class="threats-legend-item">
          <div class="threats-legend-circle" style="width:12px; height:12px;"></div>
          <span>Low Impact</span>
        </div>
      </div>
    </div>
    
    <div id="matrix-viz"></div>
  </section>

  <!-- Transition Section 2 -->
  <section id="transition-2-section" class="section transition-section">
    <div class="transition-content">
      <h2>Fortunately, fishermen, scientists, and policymakers have been banding together to <strong>take a stance</strong> for the albatrosses.</h2>
    </div>
  </section>

  <!-- Conservation Efforts -->
  <section id="conservation-section" class="section">
    <h1>Conservation Efforts</h1>
    <p class="subtitle">The following displays 6 major ways advocates have been working to prevent albatrosses' further demise to bycatch.</p>

    <div class="cons-grid">
      <!-- 1. Streamer Lines -->
      <button class="cons-card" aria-label="Streamer Lines (flip for details)">
        <div class="cons-card-inner">
          <div class="cons-face cons-front">
            <img src="images/placeholder-streamer.jpg" alt="Streamer lines behind a fishing vessel" class="cons-img"/>
            <h3 class="cons-title">Streamer Lines</h3>
          </div>
          <div class="cons-face cons-back">
            <h3>Streamer Lines</h3>
            <p>
              Colorful “tori” streamers flap behind longline boats and keep birds off baited hooks.  
              Widely adopted, these lines have slashed seabird bycatch—often by 80%+—in places like Alaska.
            </p>
          </div>
        </div>
      </button>

      <!-- 2. Set Gear at Night -->
      <button class="cons-card" aria-label="Set Gear at Night (flip for details)">
        <div class="cons-card-inner">
          <div class="cons-face cons-front">
            <img src="images/placeholder-night.jpg" alt="Nighttime longline setting" class="cons-img"/>
            <h3 class="cons-title">Set Gear at Night</h3>
          </div>
          <div class="cons-face cons-back">
            <h3>Set Gear at Night</h3>
            <p>
              Albatrosses feed mostly by day. Setting lines in darkness—and keeping deck lights low and inboard—
              drops encounters dramatically in West Coast and Western Pacific fisheries.
            </p>
          </div>
        </div>
      </button>

      <!-- 3. Weighted Hooks -->
      <button class="cons-card" aria-label="Weighted Hooks (flip for details)">
        <div class="cons-card-inner">
          <div class="cons-face cons-front">
            <img src="images/placeholder-weights.jpg" alt="Weights near hooks" class="cons-img"/>
            <h3 class="cons-title">Weighted Hooks</h3>
          </div>
          <div class="cons-face cons-back">
            <h3>Weighted Hooks</h3>
            <p>
              Adding weights makes baited hooks sink fast—beyond the 1–2&nbsp;m depths where most albatrosses grab food—
              reducing the chance birds reach the gear.
            </p>
          </div>
        </div>
      </button>

      <!-- 4. Dyeing Bait -->
      <button class="cons-card" aria-label="Dyeing Bait (flip for details)">
        <div class="cons-card-inner">
          <div class="cons-face cons-front">
            <img src="images/placeholder-bait.jpg" alt="Blue-dyed bait" class="cons-img"/>
            <h3 class="cons-title">Dyeing Bait</h3>
          </div>
          <div class="cons-face cons-back">
            <h3>Dyeing Bait</h3>
            <p>
              Blue-dyed bait is harder for birds to spot against seawater.  
              The approach began with fishers, was tested, and is now required in certain U.S. HMS longline fisheries.
            </p>
          </div>
        </div>
      </button>

      <!-- 5. Discharge Fish Waste -->
      <button class="cons-card" aria-label="Discharge Fish Waste (flip for details)">
        <div class="cons-card-inner">
          <div class="cons-face cons-front">
            <img src="images/placeholder-discharge.jpg" alt="Discharging fish waste opposite the gear" class="cons-img"/>
            <h3 class="cons-title">Discharge Fish Waste</h3>
          </div>
          <div class="cons-face cons-back">
            <h3>Discharge Fish Waste</h3>
            <p>
              Dump offal on the side opposite the baited line so scavenging birds stay away from hooks.  
              This is required across parts of the western/central Pacific; NOAA is studying results in Hawai‘i.
            </p>
          </div>
        </div>
      </button>

      <!-- 6. Side-Setting -->
      <button class="cons-card" aria-label="Side-Setting (flip for details)">
        <div class="cons-card-inner">
          <div class="cons-face cons-front">
            <img src="images/placeholder-sideset.jpg" alt="Side-setting with bird curtain" class="cons-img"/>
            <h3 class="cons-title">Side-Setting</h3>
          </div>
          <div class="cons-face cons-back">
            <h3>Side-Setting</h3>
            <p>
              Set hooks from the vessel’s side near the bow and add weights close to hooks so they sink quickly.  
              Paired with “bird curtains,” this setup sharply reduces seabird interactions.
            </p>
          </div>
        </div>
      </button>
    </div>
  </section>


  <!-- Navigation Dots -->
  <div class="nav-dots">
    <div class="nav-dot active" data-section="home"          data-label="Home"></div>                     <!-- 1 -->
    <div class="nav-dot"        data-section="anatomy"       data-label="Anatomy"></div>                  <!-- 2 -->
    <div class="nav-dot"        data-section="quiz"          data-label="Quiz"></div>                     <!-- 3 -->
    <div class="nav-dot"        data-section="map"           data-label="Interactive Map"></div>          <!-- 4 -->
    <div class="nav-dot"        data-section="info-genus"    data-label="Info"></div>                     <!-- 5 -->
    <div class="nav-dot"        data-section="species"       data-label="The Species"></div>              <!-- 6 -->
    <div class="nav-dot"        data-section="info-wind"     data-label="Info"></div>                     <!-- 7 -->
    <div class="nav-dot"        data-section="flight"        data-label="An Albatross in Flight"></div>   <!-- 8 -->
    <div class="nav-dot"        data-section="info-folk"     data-label="Info"></div>                     <!-- 9 -->
    <div class="nav-dot"        data-section="myths"         data-label="Folklore"></div>                 <!-- 10 -->
    <div class="nav-dot"        data-section="info-hazards"  data-label="Info"></div>                     <!-- 11 -->
    <div class="nav-dot"        data-section="threats"       data-label="Threats"></div>                  <!-- 12 -->
    <div class="nav-dot"        data-section="info-help"     data-label="Info"></div>                     <!-- 13 -->
    <div class="nav-dot"        data-section="conservation"  data-label="Conservation Efforts"></div>     <!-- 14 -->
  </div>


  <!-- Right Panel for Species Info -->
  <div id="species-panel">
    <button id="species-panel-close">×</button>
    <div id="species-panel-content">
      <h2 id="species-panel-title">Select a species</h2>
      <img id="species-panel-image" alt="" style="display:none;" />
      <div id="species-panel-info"></div>
      <div id="species-panel-map-container">
        <h3>Colony Locations</h3>
        <svg id="species-panel-map"></svg>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="intro.js"></script>
  <script src="visualization.js"></script>
  <script src="threats.js"></script>
  <script type="module" src="js/myths.js"></script>
  <script type="module" src="js/species-panel.js"></script>
  
  <!-- Quiz functionality -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const quizInput = document.getElementById('quiz-input');
      const quizSubmit = document.getElementById('quiz-submit');
      const quizAnswer = document.getElementById('quiz-answer');
      const quizContinue = document.getElementById('quiz-continue');
      const speciesSection = document.getElementById('species-section');

      function showAnswer() {
        const userAnswer = parseInt(quizInput.value.trim());
        const isExact = userAnswer === 46;
        const isClose = userAnswer >= 40 && userAnswer <= 50;
        
        quizSubmit.disabled = true;
        quizInput.disabled = true;
        
        // Update content based on correctness
        const answerTitle = quizAnswer.querySelector('h3');
        const answerText = quizAnswer.querySelector('p');
        
        if (isExact) {
          quizAnswer.classList.add('correct');
          quizAnswer.classList.remove('incorrect');
          answerTitle.textContent = 'Correct! Just 46 days!';
          answerText.textContent = 'Albatrosses are incredible long-distance fliers, covering thousands of miles with minimal energy expenditure. They can spend months at sea without touching land!';
        } else if (isClose) {
          quizAnswer.classList.add('correct');
          quizAnswer.classList.remove('incorrect');
          answerTitle.textContent = 'Close guess! The answer is 46 days.';
          answerText.textContent = 'Albatrosses are incredible long-distance fliers, covering thousands of miles with minimal energy expenditure. They can spend months at sea without touching land!';
        } else {
          quizAnswer.classList.add('incorrect');
          quizAnswer.classList.remove('correct');
          answerTitle.textContent = 'Not quite! The answer is 46 days.';
          answerText.textContent = 'Albatrosses are incredible long-distance fliers, covering thousands of miles with minimal energy expenditure. They can spend months at sea without touching land!';
        }
        
        quizAnswer.classList.add('visible');
        
        // Show continue button after a short delay
        setTimeout(() => {
          quizContinue.classList.add('visible');
        }, 500);
      }

      // Handle submit button click
      quizSubmit.addEventListener('click', function() {
        if (quizInput.value.trim() !== '') {
          showAnswer();
        }
      });

      // Handle Enter key press
      quizInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter' && quizInput.value.trim() !== '') {
          showAnswer();
        }
      });

      // Handle continue button click - scroll to species section
      quizContinue.addEventListener('click', function() {
        speciesSection.scrollIntoView({ 
          behavior: 'smooth',
          block: 'start'
        });
      });

      // Enable/disable submit button based on input
      quizInput.addEventListener('input', function() {
        quizSubmit.disabled = quizInput.value.trim() === '';
      });

      // Initially disable submit button
      quizSubmit.disabled = true;
    });

    // NOTE: 3D scatter is embedded inline now; overlay/button handlers removed.

    // Distance map functionality with Leaflet
    document.addEventListener('DOMContentLoaded', function() {
      const mapContainer = document.getElementById('distance-map');
      if (!mapContainer) return;

      // Boston coordinates (latitude, longitude)
      const bostonCoords = [42.3601, -71.0589];
      
      // Initialize the map
      const map = L.map('distance-map').setView(bostonCoords, 6);

      // Add OpenStreetMap tiles
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '© OpenStreetMap contributors'
      }).addTo(map);

      // Create custom red marker icon for Boston
      const redIcon = L.icon({
        iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-red.png',
        shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
        iconSize: [25, 41],
        iconAnchor: [12, 41],
        popupAnchor: [1, -34],
        shadowSize: [41, 41]
      });

      // Add Boston marker with red icon
      const bostonMarker = L.marker(bostonCoords, {icon: redIcon})
        .addTo(map)
        .bindPopup('<b>Boston, MA</b>')
        .openPopup();

      // Add 560-mile radius circle (560 miles = ~901 km)
      const radiusCircle = L.circle(bostonCoords, {
        color: '#ef4444',
        fillColor: '#ef4444',
        fillOpacity: 0.1,
        radius: 901000, // 560 miles in meters
        dashArray: '10, 10'
      }).addTo(map);

      // Function to calculate distance between two points (Haversine formula)
      function calculateDistance(lat1, lon1, lat2, lon2) {
        const R = 3959; // Earth's radius in miles
        const dLat = (lat2 - lat1) * Math.PI / 180;
        const dLon = (lon2 - lon1) * Math.PI / 180;
        const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                  Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                  Math.sin(dLon/2) * Math.sin(dLon/2);
        const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
        return R * c; // Distance in miles
      }

      // Cities within 560 miles of Boston
      const citiesInRange = [
        { name: 'New York, NY', coords: [40.7128, -74.0060] },
        { name: 'Philadelphia, PA', coords: [39.9526, -75.1652] },
        { name: 'Washington, DC', coords: [38.9072, -77.0369] },
        { name: 'Montreal, Canada', coords: [45.5017, -73.5673] },
        { name: 'Portland, ME', coords: [43.6591, -70.2553] },
        { name: 'Buffalo, NY', coords: [42.8864, -78.8784] },
        { name: 'Pittsburgh, PA', coords: [40.4406, -79.9959] },
        { name: 'Richmond, VA', coords: [37.5407, -77.4360] }
      ];

      // Add city markers with flight time calculations
      citiesInRange.forEach(city => {
        // Calculate distance from Boston to this city
        const distance = calculateDistance(
          bostonCoords[0], bostonCoords[1], // Boston lat, lon
          city.coords[0], city.coords[1]    // City lat, lon
        );
        
        // Calculate flight time (distance / 45 mph)
        const flightTimeHours = distance / 45;
        const hours = Math.floor(flightTimeHours);
        const minutes = Math.round((flightTimeHours - hours) * 60);
        
        // Format time display
        let timeText;
        if (hours === 0) {
          timeText = `${minutes} minutes`;
        } else if (minutes === 0) {
          timeText = `${hours} hour${hours > 1 ? 's' : ''}`;
        } else {
          timeText = `${hours} hour${hours > 1 ? 's' : ''} ${minutes} minutes`;
        }

        L.marker(city.coords)
          .addTo(map)
          .bindPopup(`<b>${city.name}</b><br>Distance: ${Math.round(distance)} miles<br>Flight time: ${timeText}`)
          .on('mouseover', function(e) {
            this.openPopup();
          });
      });

      // Custom control for distance info
      const distanceInfo = L.control({position: 'topright'});
      distanceInfo.onAdd = function(map) {
        const div = L.DomUtil.create('div', 'distance-info-control');
        div.style.backgroundColor = 'white';
        div.style.padding = '10px';
        div.style.borderRadius = '5px';
        div.style.boxShadow = '0 2px 5px rgba(0,0,0,0.2)';
        div.innerHTML = '<b>Albatross Daily Range</b><br>560 miles from Boston';
        return div;
      };
      distanceInfo.addTo(map);

      // Fit map to show the circle and all cities
      const group = new L.featureGroup([radiusCircle, bostonMarker, ...citiesInRange.map(city => L.marker(city.coords))]);
      map.fitBounds(group.getBounds().pad(0.1));
    });

    // Navigation dots functionality
    document.addEventListener('DOMContentLoaded', function() {
      const navDots = document.querySelectorAll('.nav-dot');
      const sections = {
        // 1–14 in order
        'home'         : document.getElementById('landing-section'),
        'anatomy'      : document.getElementById('intro-section'),
        'quiz'         : document.getElementById('quiz-section'),
        'map'          : document.getElementById('distance-section'),
        'info-genus'   : document.getElementById('info-genus-section'),
        'species'      : document.getElementById('species-section'),
        'info-wind'    : document.getElementById('transition-4-section'),   // “the wind is their highway”
        'flight'       : document.getElementById('flight-section'),          // blank
        'info-folk'    : document.getElementById('info-folklore-section'),
        'myths'        : document.getElementById('myths-section'),
        'info-hazards' : document.getElementById('transition-1-section'),    // “new hazards”
        'threats'      : document.getElementById('threats-section'),
        'info-help'    : document.getElementById('transition-2-section'),    // “here’s how to help”
        'conservation' : document.getElementById('conservation-section')     // blank
      };

      // Handle dot clicks (unchanged)
      navDots.forEach(dot => {
        dot.addEventListener('click', function() {
          const sectionName = this.getAttribute('data-section');
          const targetSection = sections[sectionName];
          if (targetSection) {
            targetSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
          }
        });
      });

      // Update active dot on scroll
      function updateActiveDot() {
        const scrollPosition = window.scrollY + window.innerHeight / 2;
        
        let activeSection = 'landing';
        
        Object.entries(sections).forEach(([name, section]) => {
          if (section) {
            const sectionTop = section.offsetTop;
            const sectionBottom = sectionTop + section.offsetHeight;
            
            if (scrollPosition >= sectionTop && scrollPosition < sectionBottom) {
              activeSection = name;
            }
          }
        });

        // Update active dot
        navDots.forEach(dot => {
          dot.classList.remove('active');
          if (dot.getAttribute('data-section') === activeSection) {
            dot.classList.add('active');
          }
        });
      }

      // Listen for scroll events
      window.addEventListener('scroll', updateActiveDot);
      
      // Initial update
      updateActiveDot();
    });
  </script>
</body>
</html>

